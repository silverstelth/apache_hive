    

<!DOCTYPE html>
<html lang="en-GB" >

<!-- Mirrored from cwiki.apache.org/confluence/display/Hive/Hive+on+Spark%3A+Join+Design+Master by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 15 Dec 2021 19:44:06 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
                            <title>Hive on Spark: Join Design Master - Apache Hive - Apache Software Foundation</title>
    
        

                        
    
                        
    

                
    
    <meta http-equiv="X-UA-Compatible" content="IE=EDGE,chrome=IE7">
<meta charset="UTF-8">
<meta id="confluence-context-path" name="confluence-context-path" content="/confluence">
<meta id="confluence-base-url" name="confluence-base-url" content="https://cwiki.apache.org/confluence">

    <meta id="atlassian-token" name="atlassian-token" content="d7833c7da397e2f88a76912a1879e0225325829d">


<meta id="confluence-space-key" name="confluence-space-key" content="Hive">
<script type="text/javascript">
        var contextPath = '/confluence';
</script>

    

    <meta name="confluence-request-time" content="1639597241698">
        
    
        
            <meta name="ajs-use-keyboard-shortcuts" content="true">
            <meta name="ajs-is-confluence-admin" content="false">
            <meta name="ajs-connection-timeout" content="10000">
            <script type="text/x-template" title="gliffy-webpanel-footer">
        <div class="gliffy-webpanel-footer"><span>This Confluence installation runs a Free Gliffy License - Evaluate the <a href="http://www.gliffy.com/products/confluence-plugin/">Gliffy Confluence Plugin</a> for your Wiki!</span></div>
</script>


            <style>.ia-fixed-sidebar, .ia-splitter-left {width: 285px;}.theme-default .ia-splitter #main {margin-left: 285px;}.ia-fixed-sidebar {visibility: hidden;}</style>
            <meta name="ajs-discovered-plugin-features" content="$discoveredList">
            <meta name="ajs-keyboardshortcut-hash" content="f372abdc7d1a6481c736efc7686d149c">
            <meta id="team-calendars-has-jira-link" content="true">
            <meta name="ajs-team-calendars-display-time-format" content="displayTimeFormat12">
            <meta id="team-calendars-display-week-number" content="false">
            <meta id="team-calendars-user-timezone" content="Etc/UTC">
            <script type="text/x-template" id="team-calendars-messages" title="team-calendars-messages"><fieldset class="i18n hidden"><input type="hidden" name="calendar3.month.long.july" value="July"><input type="hidden" name="calendar3.day.short.wednesday" value="Wed"><input type="hidden" name="calendar3.day.short.thursday" value="Thu"><input type="hidden" name="calendar3.month.short.march" value="Mar"><input type="hidden" name="calendar3.month.long.april" value="April"><input type="hidden" name="calendar3.month.long.october" value="October"><input type="hidden" name="calendar3.month.long.august" value="August"><input type="hidden" name="calendar3.month.short.july" value="Jul"><input type="hidden" name="calendar3.month.short.may" value="May"><input type="hidden" name="calendar3.month.short.november" value="Nov"><input type="hidden" name="calendar3.day.long.friday" value="Friday"><input type="hidden" name="calendar3.day.long.sunday" value="Sunday"><input type="hidden" name="calendar3.day.long.saturday" value="Saturday"><input type="hidden" name="calendar3.month.short.april" value="Apr"><input type="hidden" name="calendar3.day.long.wednesday" value="Wednesday"><input type="hidden" name="calendar3.month.long.december" value="December"><input type="hidden" name="calendar3.month.short.october" value="Oct"><input type="hidden" name="calendar3.day.long.monday" value="Monday"><input type="hidden" name="calendar3.month.short.june" value="Jun"><input type="hidden" name="calendar3.day.short.monday" value="Mon"><input type="hidden" name="calendar3.day.short.tuesday" value="Tue"><input type="hidden" name="calendar3.day.short.saturday" value="Sat"><input type="hidden" name="calendar3.month.long.march" value="March"><input type="hidden" name="calendar3.month.long.june" value="June"><input type="hidden" name="calendar3.month.short.february" value="Feb"><input type="hidden" name="calendar3.month.short.august" value="Aug"><input type="hidden" name="calendar3.month.short.december" value="Dec"><input type="hidden" name="calendar3.day.short.sunday" value="Sun"><input type="hidden" name="calendar3.month.long.february" value="February"><input type="hidden" name="calendar3.day.long.tuesday" value="Tuesday"><input type="hidden" name="calendar3.month.long.may" value="May"><input type="hidden" name="calendar3.month.long.september" value="September"><input type="hidden" name="calendar3.month.long.november" value="November"><input type="hidden" name="calendar3.month.short.january" value="Jan"><input type="hidden" name="calendar3.month.short.september" value="Sep"><input type="hidden" name="calendar3.day.long.thursday" value="Thursday"><input type="hidden" name="calendar3.month.long.january" value="January"><input type="hidden" name="calendar3.day.short.friday" value="Fri"></fieldset></script>
            
    
    
            <meta name="ajs-page-title" content="Hive on Spark: Join Design Master">
            <meta name="ajs-latest-published-page-title" content="Hive on Spark: Join Design Master">
            <meta name="ajs-space-name" content="Apache Hive">
            <meta name="ajs-page-id" content="50858744">
            <meta name="ajs-latest-page-id" content="50858744">
            <meta name="ajs-content-type" content="page">
            <meta name="ajs-parent-page-title" content="DesignDocs">
            <meta name="ajs-parent-page-id" content="27362075">
            <meta name="ajs-space-key" content="Hive">
            <meta name="ajs-max-number-editors" content="12">
            <meta name="ajs-macro-placeholder-timeout" content="5000">
            <meta name="ajs-jira-metadata-count" content="-1">
            <meta name="ajs-from-page-title" content="">
            <meta name="ajs-can-remove-page" content="false">
            <meta name="ajs-can-remove-page-hierarchy" content="false">
            <meta name="ajs-browse-page-tree-mode" content="view">
            <meta name="ajs-shared-drafts" content="true">
            <meta name="ajs-context-path" content="/confluence">
            <meta name="ajs-base-url" content="https://cwiki.apache.org/confluence">
            <meta name="ajs-version-number" content="7.13.2">
            <meta name="ajs-build-number" content="8703">
            <meta name="ajs-remote-user" content="">
            <meta name="ajs-remote-user-key" content="">
            <meta name="ajs-remote-user-has-licensed-access" content="false">
            <meta name="ajs-remote-user-has-browse-users-permission" content="false">
            <meta name="ajs-current-user-fullname" content="">
            <meta name="ajs-current-user-avatar-url" content="">
            <meta name="ajs-current-user-avatar-uri-reference" content="/confluence/images/icons/profilepics/anonymous.svg">
            <meta name="ajs-static-resource-url-prefix" content="/confluence/s/6dvx22/8703/4mhn8a/_">
            <meta name="ajs-global-settings-attachment-max-size" content="20971520">
            <meta name="ajs-global-settings-quick-search-enabled" content="true">
            <meta name="ajs-user-locale" content="en_GB">
            <meta name="ajs-enabled-dark-features" content="site-wide.shared-drafts,site-wide.synchrony,clc.quick.create,confluence.view.edit.transition,cql.search.screen,confluence-inline-comments-resolved,frontend.editor.v4,http.session.registrar,nps.survey.inline.dialog,confluence.efi.onboarding.new.templates,frontend.editor.v4.compatibility,atlassian.cdn.static.assets,pdf-preview,previews.sharing,previews.versions,file-annotations,confluence.efi.onboarding.rich.space.content,collaborative-audit-log,confluence.reindex.improvements,previews.conversion-service,editor.ajax.save,read.only.mode,graphql,previews.trigger-all-file-types,attachment.extracted.text.extractor,lucene.caching.filter,confluence.table.resizable,notification.batch,previews.sharing.pushstate,confluence-inline-comments-rich-editor,tc.tacca.dacca,site-wide.synchrony.opt-in,file-annotations.likes,gatekeeper-ui-v2,v2.content.name.searcher,mobile.supported.version,pulp,confluence-inline-comments,confluence-inline-comments-dangling-comment,quick-reload-inline-comments-flags">
            <meta name="ajs-atl-token" content="d7833c7da397e2f88a76912a1879e0225325829d">
            <meta name="ajs-confluence-flavour" content="VANILLA">
            <meta name="ajs-user-date-pattern" content="dd MMM yyyy">
            <meta name="ajs-access-mode" content="READ_WRITE">
            <meta name="ajs-render-mode" content="READ_WRITE">
            <meta name="ajs-date.format" content="MMM dd, yyyy">
    
    <link rel="shortcut icon" href="https://cwiki.apache.org/confluence/s/6dvx22/8703/4mhn8a/1/_/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://cwiki.apache.org/confluence/s/6dvx22/8703/4mhn8a/1/_/favicon.ico">

<link rel="search" type="application/opensearchdescription+xml" href="https://cwiki.apache.org/confluence/opensearch/osd.action" title="Apache Software Foundation"/>
    
                    
            <meta name="ajs-create-issue-metadata-show-discovery" content="false">
            

    <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\u0022\u005C/confluence\u0022";
WRM._unparsedData["com.atlassian.confluence.plugins.confluence-feature-discovery-plugin:confluence-feature-discovery-plugin-resources.test-mode"]="false";
WRM._unparsedData["com.atlassian.confluence.plugins.synchrony-interop:synchrony-status-banner-loader.synchrony-status"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["com.atlassian.applinks.applinks-plugin:applinks-common-exported.applinks-help-paths"]="{\u0022entries\u0022:{\u0022applinks.docs.root\u0022:\u0022https://confluence.atlassian.com/display/APPLINKS-072/\u0022,\u0022applinks.docs.diagnostics.troubleshoot.sslunmatched\u0022:\u0022SSL+and+application+link+troubleshooting+guide\u0022,\u0022applinks.docs.diagnostics.troubleshoot.oauthsignatureinvalid\u0022:\u0022OAuth+troubleshooting+guide\u0022,\u0022applinks.docs.diagnostics.troubleshoot.oauthtimestamprefused\u0022:\u0022OAuth+troubleshooting+guide\u0022,\u0022applinks.docs.delete.entity.link\u0022:\u0022Create+links+between+projects\u0022,\u0022applinks.docs.adding.application.link\u0022:\u0022Link+Atlassian+applications+to+work+together\u0022,\u0022applinks.docs.administration.guide\u0022:\u0022Application+Links+Documentation\u0022,\u0022applinks.docs.oauth.security\u0022:\u0022OAuth+security+for+application+links\u0022,\u0022applinks.docs.troubleshoot.application.links\u0022:\u0022Troubleshoot+application+links\u0022,\u0022applinks.docs.diagnostics.troubleshoot.unknownerror\u0022:\u0022Network+and+connectivity+troubleshooting+guide\u0022,\u0022applinks.docs.configuring.auth.trusted.apps\u0022:\u0022Configuring+Trusted+Applications+authentication+for+an+application+link\u0022,\u0022applinks.docs.diagnostics.troubleshoot.authlevelunsupported\u0022:\u0022OAuth+troubleshooting+guide\u0022,\u0022applinks.docs.diagnostics.troubleshoot.ssluntrusted\u0022:\u0022SSL+and+application+link+troubleshooting+guide\u0022,\u0022applinks.docs.diagnostics.troubleshoot.unknownhost\u0022:\u0022Network+and+connectivity+troubleshooting+guide\u0022,\u0022applinks.docs.delete.application.link\u0022:\u0022Link+Atlassian+applications+to+work+together\u0022,\u0022applinks.docs.adding.project.link\u0022:\u0022Configuring+Project+links+across+Applications\u0022,\u0022applinks.docs.link.applications\u0022:\u0022Link+Atlassian+applications+to+work+together\u0022,\u0022applinks.docs.diagnostics.troubleshoot.oauthproblem\u0022:\u0022OAuth+troubleshooting+guide\u0022,\u0022applinks.docs.diagnostics.troubleshoot.migration\u0022:\u0022Update+application+links+to+use+OAuth\u0022,\u0022applinks.docs.relocate.application.link\u0022:\u0022Link+Atlassian+applications+to+work+together\u0022,\u0022applinks.docs.administering.entity.links\u0022:\u0022Create+links+between+projects\u0022,\u0022applinks.docs.upgrade.application.link\u0022:\u0022OAuth+security+for+application+links\u0022,\u0022applinks.docs.diagnostics.troubleshoot.connectionrefused\u0022:\u0022Network+and+connectivity+troubleshooting+guide\u0022,\u0022applinks.docs.configuring.auth.oauth\u0022:\u0022OAuth+security+for+application+links\u0022,\u0022applinks.docs.insufficient.remote.permission\u0022:\u0022OAuth+security+for+application+links\u0022,\u0022applinks.docs.configuring.application.link.auth\u0022:\u0022OAuth+security+for+application+links\u0022,\u0022applinks.docs.diagnostics\u0022:\u0022Application+links+diagnostics\u0022,\u0022applinks.docs.configured.authentication.types\u0022:\u0022OAuth+security+for+application+links\u0022,\u0022applinks.docs.adding.entity.link\u0022:\u0022Create+links+between+projects\u0022,\u0022applinks.docs.diagnostics.troubleshoot.unexpectedresponse\u0022:\u0022Network+and+connectivity+troubleshooting+guide\u0022,\u0022applinks.docs.configuring.auth.basic\u0022:\u0022Configuring+Basic+HTTP+Authentication+for+an+Application+Link\u0022,\u0022applinks.docs.diagnostics.troubleshoot.authlevelmismatch\u0022:\u0022OAuth+troubleshooting+guide\u0022}}";
WRM._unparsedData["com.atlassian.applinks.applinks-plugin:applinks-common-exported.applinks-types"]="{\u0022crowd\u0022:\u0022Crowd\u0022,\u0022confluence\u0022:\u0022Confluence\u0022,\u0022fecru\u0022:\u0022FishEye / Crucible\u0022,\u0022stash\u0022:\u0022Stash\u0022,\u0022jira\u0022:\u0022Jira\u0022,\u0022refapp\u0022:\u0022Reference Application\u0022,\u0022bamboo\u0022:\u0022Bamboo\u0022,\u0022generic\u0022:\u0022Generic Application\u0022}";
WRM._unparsedData["com.atlassian.applinks.applinks-plugin:applinks-common-exported.entity-types"]="{\u0022singular\u0022:{\u0022refapp.charlie\u0022:\u0022Charlie\u0022,\u0022fecru.project\u0022:\u0022Crucible Project\u0022,\u0022fecru.repository\u0022:\u0022FishEye Repository\u0022,\u0022stash.project\u0022:\u0022Stash Project\u0022,\u0022generic.entity\u0022:\u0022Generic Project\u0022,\u0022confluence.space\u0022:\u0022Confluence Space\u0022,\u0022bamboo.project\u0022:\u0022Bamboo Project\u0022,\u0022jira.project\u0022:\u0022Jira Project\u0022},\u0022plural\u0022:{\u0022refapp.charlie\u0022:\u0022Charlies\u0022,\u0022fecru.project\u0022:\u0022Crucible Projects\u0022,\u0022fecru.repository\u0022:\u0022FishEye Repositories\u0022,\u0022stash.project\u0022:\u0022Stash Projects\u0022,\u0022generic.entity\u0022:\u0022Generic Projects\u0022,\u0022confluence.space\u0022:\u0022Confluence Spaces\u0022,\u0022bamboo.project\u0022:\u0022Bamboo Projects\u0022,\u0022jira.project\u0022:\u0022Jira Projects\u0022}}";
WRM._unparsedData["com.atlassian.applinks.applinks-plugin:applinks-common-exported.authentication-types"]="{\u0022com.atlassian.applinks.api.auth.types.BasicAuthenticationProvider\u0022:\u0022Basic Access\u0022,\u0022com.atlassian.applinks.api.auth.types.TrustedAppsAuthenticationProvider\u0022:\u0022Trusted Applications\u0022,\u0022com.atlassian.applinks.api.auth.types.CorsAuthenticationProvider\u0022:\u0022CORS\u0022,\u0022com.atlassian.applinks.api.auth.types.OAuthAuthenticationProvider\u0022:\u0022OAuth\u0022,\u0022com.atlassian.applinks.api.auth.types.TwoLeggedOAuthAuthenticationProvider\u0022:\u0022OAuth\u0022,\u0022com.atlassian.applinks.api.auth.types.TwoLeggedOAuthWithImpersonationAuthenticationProvider\u0022:\u0022OAuth\u0022}";
WRM._unparsedData["com.atlassian.confluence.plugins.confluence-license-banner:confluence-license-banner-resources.license-details"]="{\u0022daysBeforeLicenseExpiry\u0022:0,\u0022daysBeforeMaintenanceExpiry\u0022:0,\u0022showLicenseExpiryBanner\u0022:false,\u0022showMaintenanceExpiryBanner\u0022:false,\u0022renewUrl\u0022:null,\u0022salesUrl\u0022:null}";
WRM._unparsedData["com.atlassian.confluence.plugins.confluence-search-ui-plugin:confluence-search-ui-plugin-resources.i18n-data"]="{\u0022search.ui.recent.link.text\u0022:\u0022View more recently visited\u0022,\u0022search.ui.filter.space.category.input.label\u0022:\u0022Find space categories...\u0022,\u0022search.ui.search.results.empty\u0022:\u0022We couldn\u005Cu0027\u005Cu0027t find anything matching \u005C\u0022{0}\u005C\u0022.\u0022,\u0022search.ui.filter.clear.selected\u0022:\u0022Clear selected items\u0022,\u0022search.ui.content.name.search.items.panel.load.all.top.items.button.text\u0022:\u0022Show more app results...\u0022,\u0022search.ui.filter.space.archive.label\u0022:\u0022Search archived spaces\u0022,\u0022search.ui.filter.label\u0022:\u0022filter\u0022,\u0022search.ui.filter.contributor.button.text\u0022:\u0022Contributor\u0022,\u0022search.ui.filter.date.all.text\u0022:\u0022Any time\u0022,\u0022search.ui.filter.space.current.label\u0022:\u0022CURRENT\u0022,\u0022search.ui.clear.input.button.text\u0022:\u0022Clear text\u0022,\u0022search.ui.search.results.clear.button\u0022:\u0022clear your filters.\u0022,\u0022search.ui.filter.date.hour.text\u0022:\u0022The past day\u0022,\u0022help.search.ui.link.title\u0022:\u0022Search tips\u0022,\u0022search.ui.filters.heading\u0022:\u0022Filter by\u0022,\u0022search.ui.filter.label.input.label\u0022:\u0022Find labels...\u0022,\u0022search.ui.recent.items.anonymous\u0022:\u0022Start exploring. Your search results will appear here.\u0022,\u0022search.ui.filter.date.month.text\u0022:\u0022The past month\u0022,\u0022search.ui.input.label\u0022:\u0022Search\u0022,\u0022search.ui.search.result\u0022:\u0022{0,choice,1#{0} search result|1\u005Cu003c{0} search results}\u0022,\u0022search.ui.infinite.scroll.button.text\u0022:\u0022More results\u0022,\u0022search.ui.filter.date.button.text\u0022:\u0022Date\u0022,\u0022search.ui.filter.date.week.text\u0022:\u0022The past week\u0022,\u0022search.ui.filter.label.button.text\u0022:\u0022Label\u0022,\u0022search.ui.input.alert\u0022:\u0022Hit enter to search\u0022,\u0022search.ui.result.subtitle.calendar\u0022:\u0022Team calendar\u0022,\u0022search.ui.filter.no.result.text\u0022:\u0022We can\u005Cu0027\u005Cu0027t find anything matching your search\u0022,\u0022search.ui.filter.date.heading\u0022:\u0022Last modified within\u0022,\u0022search.ui.result.subtitle.user\u0022:\u0022User profile\u0022,\u0022search.ui.filter.contributor.input.label\u0022:\u0022Find people...\u0022,\u0022search.ui.filter.content.type.button.text\u0022:\u0022Type\u0022,\u0022search.ui.filter.space.input.label\u0022:\u0022Find spaces...\u0022,\u0022search.ui.filter.date.year.text\u0022:\u0022The past year\u0022,\u0022search.ui.advanced.search.link.text\u0022:\u0022Advanced search\u0022,\u0022search.ui.filter.space.button.text\u0022:\u0022Space\u0022,\u0022search.ui.generic.error\u0022:\u0022Something went wrong. Refresh the page, or contact your admin if this keeps happening.\u0022,\u0022search.ui.recent.spaces\u0022:\u0022Recent Spaces\u0022,\u0022search.ui.search.results.clear.line2\u0022:\u0022Try a different search term or\u0022,\u0022search.ui.filter.space.category.button.text\u0022:\u0022Space category\u0022,\u0022search.ui.search.results.clear.line1\u0022:\u0022We couldn\u005Cu0027\u005Cu0027t find anything matching your search.\u0022,\u0022search.ui.content.name.search.items.panel.load.all.top.items.admin.button.text\u0022:\u0022Show more settings and app results...\u0022,\u0022search.ui.recent.pages\u0022:\u0022Recently visited\u0022,\u0022search.ui.search.result.anonymous\u0022:\u0022{0,choice,1#{0} search result|1\u005Cu003c{0} search results}. Have an account? {1}Log in{2} to expand your search.\u0022,\u0022search.ui.recent.items.empty\u0022:\u0022Start exploring. Pages and spaces you\u005Cu0027\u005Cu0027ve visited recently will appear here.\u0022,\u0022search.ui.result.subtitle.space\u0022:\u0022Space\u0022,\u0022search.ui.filter.space.init.heading\u0022:\u0022recent spaces\u0022}";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script>
<link type="text/css" rel="stylesheet" href="../../s/ad0cdaf669e3a7800fb6fa6452e260e4-CDN/6dvx22/8703/4mhn8a/6b1577085985a611eea3c1e80e0e7e93/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all">
<link type="text/css" rel="stylesheet" href="../../s/585884a9f3984b0aaecef0baf40c1e6e-CDN/6dvx22/8703/4mhn8a/e6aaebbd7baa9a045ec96374ae08d3b2/_/download/contextbatch/css/atl.confluence.plugins.pagetree-desktop%2cmain%2cvi/batch1203.css?gatekeeper-ui-v2=true&amp;highlightactions=true&amp;hostenabled=true" data-wrm-key="atl.confluence.plugins.pagetree-desktop,main,viewcontent,atl.general,page,atl.comments,-_super" data-wrm-batch-type="context" media="all">
<script type="text/javascript" src="../../s/58e418cc99c782d6bf891d0ee81d3e82-CDN/6dvx22/8703/4mhn8a/6b1577085985a611eea3c1e80e0e7e93/_/download/contextbatch/js/_super/batch6116.js?locale=en-GB" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script>
<script type="text/javascript" src="../../s/d8f9091841663d4e3446e48379e476f1-CDN/6dvx22/8703/4mhn8a/e6aaebbd7baa9a045ec96374ae08d3b2/_/download/contextbatch/js/atl.confluence.plugins.pagetree-desktop%2cmain%2cvi/batch3a32.js?gatekeeper-ui-v2=true&amp;highlightactions=true&amp;hostenabled=true&amp;locale=en-GB" data-wrm-key="atl.confluence.plugins.pagetree-desktop,main,viewcontent,atl.general,page,atl.comments,-_super" data-wrm-batch-type="context" data-initially-rendered></script>

    

        
    

        
        <meta name="ajs-site-title" content="Apache Software Foundation" />
            
    

    
                <link rel="canonical" href="Hive%2bon%2bSpark_%2bJoin%2bDesign%2bMaster.html">
        <link rel="shortlink" href="https://cwiki.apache.org/confluence/x/_AoIAw">
    <meta name="wikilink" content="[Hive:Hive on Spark: Join Design Master]">
    <meta name="page-version" content="9">
    <meta name="ajs-page-version" content="9">

</head>

    
<body      id="com-atlassian-confluence" class="theme-default  aui-layout aui-theme-default">

        
            

<fieldset class="parameters hidden" style="display: none;">
            <input type="hidden" id="listAnalyticsKey" value="19"/>
        <input type="hidden" id="listAnalyticsDomain" value="comalatech.matomo.cloud"/>
    </fieldset>
            <div id='stp-licenseStatus-banner'></div>
    <ul id="assistive-skip-links" class="assistive">
    <li><a href="#title-heading">Skip to content</a></li>
    <li><a href="#breadcrumbs">Skip to breadcrumbs</a></li>
    <li><a href="#header-menu-bar">Skip to header menu</a></li>
    <li><a href="#navigation">Skip to action menu</a></li>
    <li><a href="#quick-search-query">Skip to quick search</a></li>
</ul>
<div id="page">
<div id="full-height-container">
    <div id="header-precursor">
        <div class="cell">
            
                            </div>
    </div>
        





<header id="header" role="banner">
    <nav class="aui-header aui-dropdown2-trigger-group" aria-label="Site"><div class="aui-header-inner"><div class="aui-header-before"><button class=" aui-dropdown2-trigger app-switcher-trigger aui-dropdown2-trigger-arrowless" aria-controls="app-switcher" aria-haspopup="true" role="button" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></button><div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" hidden data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}"><div class="app-switcher-loading">Loading&hellip;</div></div></div><div class="aui-header-primary"><span id="logo" class="aui-header-logo aui-header-logo-confluence"><a href="https://cwiki.apache.org/confluence/" aria-label="Go to home page"><span class="aui-header-logo-device">Apache Software Foundation</span></a></span><ul class="aui-nav">
                            <li>
            
        
        
<a  id="space-directory-link" href="https://cwiki.apache.org/confluence/spacedirectory/view.action"  class=" aui-nav-imagelink"   title="Spaces">
            <span>Spaces</span>
    </a>
        </li>
                                <li class="aui-buttons">
            </li>
</ul>
</div><div class="aui-header-secondary"><ul class="aui-nav">
                        <li>
        <div id="search-ui" class="aui-quicksearch dont-default-focus header-quicksearch"><input id="quick-search-query" aria-label="Search" placeholder="Search" type="text" /><div id="quick-search-alert" role="alert">Hit enter to search</div><aui-spinner size="small"></aui-spinner></div>
    </li>
        <li>
            
        <a id="help-menu-link" class="aui-nav-link aui-dropdown2-trigger aui-dropdown2-trigger-arrowless" href="#" aria-haspopup="true" aria-owns="help-menu-link-content" title="Help">
        <span class="aui-icon aui-icon-small aui-iconfont-question-filled">Help</span>
    </a>
    <nav id="help-menu-link-content" class="aui-dropdown2 aui-style-default" aria-hidden="true">
                    <div class="aui-dropdown2-section">
                                <ul  id="help-menu-link-leading" class="aui-list-truncate section-leading first">
                                            <li>
        
            
<a  id="confluence-help-link" href="https://docs.atlassian.com/confluence/docs-713/" class="    "      title="Visit the Confluence documentation home"  target="_blank"
>
        Online Help
</a>
</li>
                                            <li>
    
            
<a  id="keyboard-shortcuts-link" href="https://cwiki.apache.org/confluence" class="    "      title="View available keyboard shortcuts" >
        Keyboard Shortcuts
</a>
</li>
                                            <li>
    
            
<a  id="feed-builder-link" href="https://cwiki.apache.org/confluence/dashboard/configurerssfeed.action" class="    "      title="Create your custom RSS feed." >
        Feed Builder
</a>
</li>
                                            <li>
    
            
<a  id="whats-new-menu-link" href="https://docs.atlassian.com/confluence/docs-713/help.whats.new.iframe.link" class="    "      title="" >
        What’s new
</a>
</li>
                                            <li>
    
            
<a  id="whats-new-menu-link" href="https://confluence.atlassian.com/display/DOC/Confluence+7.13+Release+Notes" class="    "      title="" >
        What’s new
</a>
</li>
                                            <li>
    
            
<a  id="gadget-directory-link" href="https://cwiki.apache.org/confluence" class="   user-item administration-link "      title="Browse gadgets provided by Confluence" >
        Available Gadgets
</a>
</li>
                                            <li>
    
            
<a  id="confluence-about-link" href="https://cwiki.apache.org/confluence/aboutconfluencepage.action" class="    "      title="Get more information about Confluence" >
        About Confluence
</a>
</li>
                                    </ul>
            </div>
            </nav>
    
    </li>
        <li>
                
    
    </li>
        <li>
            
    </li>
        <li>
                                            <li>
        
            
<a  id="login-link" href="https://cwiki.apache.org/confluence/login.action?os_destination=%2Fdisplay%2FHive%2FHive%2Bon%2BSpark%3A%2BJoin%2BDesign%2BMaster" class="   user-item login-link "      title="" >
        Log in
</a>
</li>
                        <li>
    
            
<a  id="signup-link" href="https://cwiki.apache.org/confluence/signup.action" class="   user-item signup-link "      title="" >
        Sign up
</a>
</li>
                        
    </li>
    </ul>
</div></div><!-- .aui-header-inner--></nav><!-- .aui-header -->
    <br class="clear">
</header>
    

    
    	<div class="ia-splitter">
    		<div class="ia-splitter-left">
    			<div class="ia-fixed-sidebar">
                                            
                            <div class="acs-side-bar ia-scrollable-section"><div class="acs-side-bar-space-info tipsy-enabled" data-configure-tooltip="Edit space details"><div class="avatar"><div class="space-logo" data-key="Hive" data-name="Apache Hive" data-entity-type="confluence.space"><div class="avatar-img-container"><div class="avatar-img-wrapper"><a href="Home.html" title="Apache Hive"><img class="avatar-img" src="https://cwiki.apache.org/confluence/download/attachments/27362113/Hive?version=2&amp;modificationDate=1317659390000&amp;api=v2" alt="Apache Hive"></a></div></div></div></div><div class="space-information-container"><div class="name"><a href="Home.html" title="Apache Hive">Apache Hive</a></div><div class="flyout-handle icon aui-icon aui-icon-small aui-iconfont-edit"></div></div></div><div class="acs-side-bar-content"><div class="acs-nav-wrapper"><div class="acs-nav" data-has-create-permission="false" data-quick-links-state="null" data-page-tree-state="null" data-nav-type="pages"><div class="acs-nav-sections"><div class="main-links-section "><ul class="acs-nav-list"><li class="acs-nav-item wiki current-item" aria-current="true" data-collector-key="spacebar-pages"><a class="acs-nav-item-link tipsy-enabled" href="https://cwiki.apache.org/confluence/collector/pages.action?key=Hive" data-collapsed-tooltip="Pages"><span class="icon"></span><span class="acs-nav-item-label">Pages</span></a></li><li class="acs-nav-item blog" data-collector-key="spacebar-blogs"><a class="acs-nav-item-link tipsy-enabled" href="https://cwiki.apache.org/confluence/pages/viewrecentblogposts.action?key=Hive" data-collapsed-tooltip="Blog"><span class="icon"></span><span class="acs-nav-item-label">Blog</span></a></li></ul></div><div class="quick-links-wrapper"><h5 class="ia-quick-links-header-title">Space shortcuts</h5><div class="quick-links-section tipsy-enabled "><ul class="acs-nav-list"><li class="acs-nav-item pinned_page blueprint kb-how-to-article"><a class="acs-nav-item-link tipsy-enabled" href="How-to%2barticles.html" data-collapsed-tooltip="null"><span class="icon"></span><span class="acs-nav-item-label">How-to articles</span></a></li></ul></div></div></div></div></div><div class="ia-secondary-container tipsy-enabled" data-tree-type="pages"><div class="ia-secondary-header"><h5 class="ia-secondary-header-title pages"><span class="label">Child pages</span></h5></div><div class="ia-secondary-parent-content"><ul class="parent ia-secondary-header-title wiki"><li class="parent-item"><a class="parent-item-link" href="DesignDocs.html" title="DesignDocs"><span class="icon"></span><span class="label">DesignDocs</span></a></li></ul></div><div class="ia-secondary-current-content"><ul class="ia-secondary-currentPage-title wiki current-item"><li><span class="icon"></span><span class="label">Hive on Spark: Join Design Master</span></li></ul></div><div class="ia-secondary-content"><div class="contextual-nav-child-pages"></div></div></div></div><div class="hidden"><a href="https://cwiki.apache.org/confluence/collector/pages.action?key=Hive" id="space-pages-link"></a><script type="text/x-template" title="logo-config-content"><h2>Space Details</h2><div class="personal-space-logo-hint">Your profile picture is used as the logo for your personal space. <a href="/confluence/users/profile/editmyprofilepicture.action" target="_blank">Change your profile picture</a>.</div></script></div></div><div class="space-tools-section"><div id="space-tools-menu-additional-items" class="hidden"><div data-label="Browse pages" data-class="" data-href="/confluence/pages/reorderpages.action?key=Hive">Browse pages</div></div><button id="space-tools-menu-trigger"  class=" aui-dropdown2-trigger aui-button aui-button-subtle tipsy-enabled aui-dropdown2-trigger-arrowless " aria-controls="space-tools-menu" aria-haspopup="true" role="button" data-aui-trigger><span class="aui-icon aui-icon-small aui-iconfont-configure">Configure</span><span class="aui-button-label">Space tools</span><span class="aui-icon "></span></button><div id="space-tools-menu" class="aui-dropdown2 aui-style-default space-tools-dropdown" role="menu" hidden data-aui-alignment="top left"></div><a href="#" role="button" class="expand-collapse-trigger aui-icon aui-icon-small aui-iconfont-chevron-double-left" aria-expanded="true"></a></div>
                    
                        			</div>
    		</div>
        <!-- \#header -->

            
    
        <div id="main" class=" aui-page-panel">
                        <div id="main-header">
                        
    <div id="navigation" class="content-navigation view">
                    <ul class="ajs-menu-bar">
                                            
        <li class="normal ajs-menu-item">
        <a id="action-menu-link" class="action aui-dropdown2-trigger-arrowless aui-button aui-button-subtle ajs-menu-title aui-dropdown2-trigger" href="#" aria-haspopup="true" aria-label="More options" aria-owns="action-menu" data-container="#navigation">
            <span>
                                    <span class="aui-icon aui-icon-small aui-iconfont-more" aria-label="More options"></span>
                                
            </span>
        </a>         <div id="action-menu" class="aui-dropdown2 aui-style-default" aria-hidden="true">
                            <div class="aui-dropdown2-section">
                    <ul  id="action-menu-primary"                         class="section-primary first">
                                                    <li>

    
        
    
                                                        
    
    
            <a  id="view-attachments-link" href="https://cwiki.apache.org/confluence/pages/viewpageattachments.action?pageId=50858744" rel="nofollow" class="action-view-attachments"  accessKey="t"  title="View Attachments" >
                        <span>
                                A<u>t</u>tachments (2)
            </span>        </a>
    </li>
                                                <li>

    
        
    
                                                        
    
    
            <a  id="action-view-history-link" href="https://cwiki.apache.org/confluence/pages/viewpreviousversions.action?pageId=50858744" rel="nofollow" class="action-view-history"   title="" >
                        <span>
                                Page History
            </span>        </a>
    </li>
                                                <li>

    
        
    
                                                        
    
    
            <a  id="who-can-view-button-ak-button" href="https://cwiki.apache.org/confluence" rel="nofollow" class="who-can-view-link"   title="" >
                        <span>
                                People who can view
            </span>        </a>
    </li>
                                        </ul>
                </div>
                            <div class="aui-dropdown2-section">
                    <ul  id="action-menu-secondary"                         class="section-secondary">
                                                    <li>

    
        
    
                                                        
    
    
            <a  id="view-resolved-comments" href="https://cwiki.apache.org/confluence" rel="nofollow" class=""   title="" >
                        <span>
                                Resolved comments
            </span>        </a>
    </li>
                                                <li>

    
        
    
                                                        
    
    
            <a  id="view-page-info-link" href="https://cwiki.apache.org/confluence/pages/viewinfo.action?pageId=50858744" rel="nofollow" class="action-view-info"   title="" >
                        <span>
                                Page Information
            </span>        </a>
    </li>
                                                <li>

    
        
    
                                                        
    
    
            <a  id="view-in-hierarchy-link" href="https://cwiki.apache.org/confluence/pages/reorderpages.action?key=Hive&amp;openId=50858744#selectedPageInHierarchy" rel="nofollow" class=""   title="" >
                        <span>
                                View in Hierarchy
            </span>        </a>
    </li>
                                                <li>

    
        
    
                                                        
    
    
            <a  id="action-view-source-link" href="https://cwiki.apache.org/confluence/plugins/viewsource/viewpagesrc.action?pageId=50858744" rel="nofollow" class="action-view-source popup-link"   title="" >
                        <span>
                                View Source
            </span>        </a>
    </li>
                                                <li>

    
        
    
                                                        
    
    
            <a  id="delete-all-comments-link-link" href="https://cwiki.apache.org/confluence/plugins/aptis/deleteAllComments/ask-user.action?pageId=50858744" rel="nofollow" class=""   title="" >
                        <span>
                                Delete comments
            </span>        </a>
    </li>
                                                <li>

    
        
    
                                                        
    
    
            <a  id="action-export-pdf-link" href="https://cwiki.apache.org/confluence/spaces/flyingpdf/pdfpageexport.action?pageId=50858744" rel="nofollow" class=""   title="" >
                        <span>
                                Export to PDF
            </span>        </a>
    </li>
                                                <li>

    
        
    
                                                        
    
    
            <a  id="com-k15t-confluence-scroll-epub-launcher" href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=50858744" rel="nofollow" class=""   title="" >
                        <span>
                                Export to EPUB
            </span>        </a>
    </li>
                                                <li>

    
        
    
                                                        
    
    
            <a  id="action-export-word-link" href="https://cwiki.apache.org/confluence/exportword?pageId=50858744" rel="nofollow" class="action-export-word"   title="" >
                        <span>
                                Export to Word
            </span>        </a>
    </li>
                                        </ul>
                </div>
                            <div class="aui-dropdown2-section">
                    <ul  id="action-menu-modify"                         class="section-modify">
                                                    <li>

    
        
    
                                                        
    
    
            <a  id="treecopy-action" href="https://cwiki.apache.org/confluence/plugins/tree-copy/preparing-copying.action?pageId=50858744" rel="nofollow" class=""   title="" >
                        <span>
                                Copy Page Tree
            </span>        </a>
    </li>
                                        </ul>
                </div>
                    </div>
    </li>
            </ul>
    </div>

            
            <div id="title-heading" class="pagetitle with-breadcrumbs">
                
                                    <div id="breadcrumb-section">
                        
    
    
    <ol id="breadcrumbs">
                                        
                        
        <li class="first" >
                        
                            <span class=""><a href="https://cwiki.apache.org/confluence/collector/pages.action?key=Hive">Pages</a></span>
                                                                                    
                        
        <li>
                        
                            <span class=""><a href="DesignDocs.html">DesignDocs</a></span>
                                                                    </ol>


                    </div>
                
                
        <a href="#page-banner-end" class="assistive">Skip to end of banner</a>
<div id="page-banner-start" class="assistive"></div>

                    
            <div id="page-metadata-banner"><ul class="banner"><li id="system-content-items" class="noprint"><a href="#" title="Unrestricted" id="content-metadata-page-restrictions-hidden" class="hidden"></a><a href="https://cwiki.apache.org/confluence/pages/viewpageattachments.action?pageId=50858744&amp;metadataLink=true" title="2 attachments" id="content-metadata-attachments" class="aui-icon aui-icon-small aui-iconfont-attachment"></a></li><li class="page-metadata-item noprinthas-button"  id="content-metadata-jira-wrapper"><a href="#" title="" id="content-metadata-jira" class="aui-button aui-button-subtle content-metadata-jira tipsy-disabled hidden"><span>Jira links</span></a></li></ul></div>
            

<a href="#page-banner-start" class="assistive">Go to start of banner</a>
<div id="page-banner-end" class="assistive"></div>
    

                <h1 id="title-text" class="with-breadcrumbs">
                                                <a href="Hive%2bon%2bSpark_%2bJoin%2bDesign%2bMaster.html">Hive on Spark: Join Design Master</a>
                                    </h1>
            </div>
        </div><!-- \#main-header -->
        
        

        <div id="sidebar-container">
                                                </div><!-- \#sidebar-container -->

        
    

        




            
    

                                
    

    
    
        
    
    
                    
    

    

    
            
        

    
    

    
            
        



    
<div id="content" class="page view">
    


<div id="action-messages">
                        </div>



            <script type="text/x-template" title="searchResultsGrid">
    <table class="aui">
        <thead>
            <tr class="header">
                <th class="search-result-title">Page Title</th>
                <th class="search-result-space">Space</th>
                <th class="search-result-date">Updated</th>
            </tr>
        </thead>
    </table>
</script>
<script type="text/x-template" title="searchResultsGridCount">
    <p class="search-result-count">{0}</p>
</script>
<script type="text/x-template" title="searchResultsGridRow">
    <tr class="search-result">
        <td class="search-result-title"><a href="{1}" class="content-type-{2}"><span>{0}</span></a></td>
        <td class="search-result-space"><a class="space" href="/confluence/display/{4}/" title="{3}">{3}</a></td>
        <td class="search-result-date"><span class="date" title="{6}">{5}</span></td>
    </tr>
</script>
        
    
            

        
                            
    

                    

        
        <a href="#page-metadata-end" class="assistive">Skip to end of metadata</a>
<div id="page-metadata-start" class="assistive"></div>

    <div class="page-metadata">
        <ul>
            <li class="page-metadata-modification-info">
                
        
    
        
    
        
            
            Created by <span class='author'>     <a href="https://cwiki.apache.org/confluence/login.action?os_destination=%2Fusers%2Fviewuserprofile.action%3Fusername%3Dszehon&amp;permissionViolation=true"
                       class="url fn"
                            >Szehon Ho</a></span>, last modified on <a class='last-modified' title='Show changes' href='https://cwiki.apache.org/confluence/pages/diffpagesbyversion.action?pageId=50858744&amp;selectedPageVersions=8&amp;selectedPageVersions=9'>Jan 13, 2015</a>
                </li>
        </ul>
    </div>


<a href="#page-metadata-start" class="assistive">Go to start of metadata</a>
<div id="page-metadata-end" class="assistive"></div>

        
                                            
        <div id="main-content" class="wiki-content">
                           
        <p><span style="color: rgb(0,0,0);"><div class="toc-macro client-side-toc-macro  conf-macro output-block" data-headerelements="H1,H2,H3,H4,H5,H6,H7" data-hasbody="false" data-macro-name="toc"> </div><br/></span></p><h2 id="HiveonSpark:JoinDesignMaster-PurposeandPrerequisites"><span style="color: rgb(0,0,0);">Purpose and Prerequisites</span></h2><p><span style="color: rgb(0,0,0);">The purpose of this document is to summarize the findings of all the research of different joins and describe a unified design to attack the problem in Spark.  It will identify the optimization processors will be involved and their responsibilities.</span></p><p><span style="color: rgb(0,0,0);">It is not the purpose to go in depth for design of the various join implementations in Spark, such as the common-join (<a href="https://issues.apache.org/jira/browse/HIVE-7384" class="external-link" rel="nofollow">HIVE-7384</a>), or the optimized join variants like mapjoin (<a href="https://issues.apache.org/jira/browse/HIVE-7613" class="external-link" rel="nofollow">HIVE-7613</a>), skew-join (<a href="https://issues.apache.org/jira/browse/HIVE-8406" class="external-link" rel="nofollow">HIVE-8406</a>) or SMB mapjoin (<a href="https://issues.apache.org/jira/browse/HIVE-8202" class="external-link" rel="nofollow">HIVE-8202</a>).  It will be helpful to refer to the design documents attached on JIRA for those details before reading this document, as they will also contain some background of how they are implemented in MapReduce and comparisons.  Lastly, it will also be helpful to read the overall <a href="Hive%2bon%2bSpark.html">Hive on Spark</a> design doc before reading this document.</span></p><h2 id="HiveonSpark:JoinDesignMaster-MapReduceSummary"><span style="color: rgb(0,0,0);">MapReduce Summary</span></h2><p><span style="color: rgb(0,0,0);">This section summarizes plan-generation of different joins of Hive on MapReduce, which will serve as a model for Spark.  We aim to support most of these join optimizations.  Priority will be for the automatically-optimized joins, followed by those that need user input, such as hints and metadata.</span></p><p><span style="color: rgb(0,0,0);line-height: 1.4285715;">Over the years, there have been lots of join optimization introduced to Hive beyond the common-join, via Processors (partial transformation of operator-tree or work tree).  The following diagram (Figure 1) shows the relationships of different Processors, each of which does a small part in transforming an operator-tree from common-join to one of the optimized join work-trees (mapjoin, bucket mapjoin, SMB mapjoin, or skewjoin).</span></p><p><span style="color: rgb(0,0,0);">Processors are represented by boxes in the following diagram:  They are split into three types:</span></p><ul><li><p><span>Logical optimization processor (Green):  Deals with pure operator-tree (no physical works).</span></p></li><li><p><span>Work-generation processor (Blue):  Deals with operator-tree and takes part in forming a physical work-tree.</span></p></li><li><p><span>Physical optimization processor (Red):  Deals with fully-formed physical work-tree.</span></p></li></ul><p><span style="color: rgb(0,0,0);">Each processor box shows the triggering condition, either a Hive configuration property, or the presence of a certain operator in the tree.  So, you can see how to trigger a particular join by following its path through processors and making sure all configurations are triggered and the given operator has been created by previous processors.  There are further conditions to do the transform listed on the top, (ie, size of table, etc), that are not be explained by this document, and can be referred from documents of individual joins.</span></p><h3 id="HiveonSpark:JoinDesignMaster-Figure1.JoinProcessorsforHiveonMapReduce"><span><span><span style="color: rgb(0,0,0);">Figure 1. Join Processors for Hive on MapReduce</span><br/></span></span></h3><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" width="900" confluence-query-params="effects=border-simple,blur-border" src="../../download/attachments/50858744/image2015-1-12%2015_0_2529b5.png?version=1&amp;modificationDate=1421103796000&amp;api=v2&amp;effects=border-simple,blur-border" data-image-src="/confluence/download/attachments/50858744/image2015-1-12%2015%3A0%3A25.png?version=1&amp;modificationDate=1421103796000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="51183928" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2015-1-12 15:0:25.png" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="50858744" data-linked-resource-container-version="9"></span></p><p><span style="color: rgb(0,0,0);">The input arrow at top before any Processor is always an operator-plan for common-join, which is shown as follows.  In other words, this is the original join plan if none of the optimizer processors are activated.</span></p><p><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh5.googleusercontent.com/6XjRKhcU5NqlT2-45wDW9f3lS188yRFFLzTVcPK77RKrrV6P2Box7n_qLxse7tdaH968Pnfg29ErRWzFWgYclNIwNFBus91eqoCGddM4hTmm8R-n2q39k3RtoH_1y7Jm5g" data-image-src="https://lh5.googleusercontent.com/6XjRKhcU5NqlT2-45wDW9f3lS188yRFFLzTVcPK77RKrrV6P2Box7n_qLxse7tdaH968Pnfg29ErRWzFWgYclNIwNFBus91eqoCGddM4hTmm8R-n2q39k3RtoH_1y7Jm5g"></span></span></p><p><span style="color: rgb(0,0,0);">The ‘exit’ arrows of the join paths shown in Figure 1 are the various optimized join variants.  There are of course other exit paths, in which the plan remains unchanged as a common-join upon falling out of any processor’s pre-req checks, but they are not shown to simplify the diagram.</span></p><p><span style="color: rgb(0,0,0);"><br/></span></p><p><span style="color: rgb(0,0,0);">Description of the some important Processors follows.  Again, there’s no space to describe them all, so few key ones are chosen.</span></p><ul><li><p><span>SortedBucketMapJoinProc: This logical optimization processor handles auto-conversion of common-join operator-tree to SMB join operator-tree, for further processing.</span></p></li></ul><p><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh3.googleusercontent.com/vEyeVd9osItYVMQD9QdyW9Yhg_CTTcCWstOboqDAiNkLoEt096giFXXbJ6IRXXIPzuraJDuefpP8ZVjBPStR7n0VUYkNiNXxTuPkT2clFHjGQomwKQOyd8OlEZFmfFBiiQ" data-image-src="https://lh3.googleusercontent.com/vEyeVd9osItYVMQD9QdyW9Yhg_CTTcCWstOboqDAiNkLoEt096giFXXbJ6IRXXIPzuraJDuefpP8ZVjBPStR7n0VUYkNiNXxTuPkT2clFHjGQomwKQOyd8OlEZFmfFBiiQ"></span></span><span style="color: rgb(0,0,0);">to</span><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh6.googleusercontent.com/R3akhcjTnYUlBlScZbhlILMQKEzKX_lGd1wHQCL8z9F6PhIf_fODRcAHh2Z1vW0_5bEuHbnheKo0iPr7tX2jxHKzTGigXIm5BFb0mjt9jxJzh5_Ba0KzYHCGamopDnyGfQ" data-image-src="https://lh6.googleusercontent.com/R3akhcjTnYUlBlScZbhlILMQKEzKX_lGd1wHQCL8z9F6PhIf_fODRcAHh2Z1vW0_5bEuHbnheKo0iPr7tX2jxHKzTGigXIm5BFb0mjt9jxJzh5_Ba0KzYHCGamopDnyGfQ"></span></span></p><ul><li><p><span>MapJoinProcessor: This logical optimization processor handles initial conversion of common-join operator-tree to mapjoin operator-tree, for further-processing, when user has given hints to identify the small tables.</span></p></li></ul><p><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh3.googleusercontent.com/vEyeVd9osItYVMQD9QdyW9Yhg_CTTcCWstOboqDAiNkLoEt096giFXXbJ6IRXXIPzuraJDuefpP8ZVjBPStR7n0VUYkNiNXxTuPkT2clFHjGQomwKQOyd8OlEZFmfFBiiQ" data-image-src="https://lh3.googleusercontent.com/vEyeVd9osItYVMQD9QdyW9Yhg_CTTcCWstOboqDAiNkLoEt096giFXXbJ6IRXXIPzuraJDuefpP8ZVjBPStR7n0VUYkNiNXxTuPkT2clFHjGQomwKQOyd8OlEZFmfFBiiQ"></span></span><span style="color: rgb(0,0,0);">to</span><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh6.googleusercontent.com/5lb1EC5zNUPY2KBa0odFOXmuIKeSH4CES8dSbbb1lBUMwdwoJdoF4tuNdA4Vb_sJWZdLdeagos2Wofk2TqcZZ8MXcGwKDfhhq8tQiIPRuSxOYUQM2RLJzYpVKFiWIHDllw" data-image-src="https://lh6.googleusercontent.com/5lb1EC5zNUPY2KBa0odFOXmuIKeSH4CES8dSbbb1lBUMwdwoJdoF4tuNdA4Vb_sJWZdLdeagos2Wofk2TqcZZ8MXcGwKDfhhq8tQiIPRuSxOYUQM2RLJzYpVKFiWIHDllw"></span></span></p><ul><li><p><span>MapJoinFactory: This follows MapJoinProcessor as part of work-generation phase.  It handles the work-tree created from that, adding a local work to identify the small-tables.  It also follows after SortedBucketMapJoinProc in the SMB MapJoin path as part of its work-generation phase in a similar way, also adding a local work to identify the small tables for SMB MapJoin.</span></p></li></ul><p><span style="color: rgb(0,0,0);">MapJoinFactory MapJoin processing:</span></p><p><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh6.googleusercontent.com/5lb1EC5zNUPY2KBa0odFOXmuIKeSH4CES8dSbbb1lBUMwdwoJdoF4tuNdA4Vb_sJWZdLdeagos2Wofk2TqcZZ8MXcGwKDfhhq8tQiIPRuSxOYUQM2RLJzYpVKFiWIHDllw" data-image-src="https://lh6.googleusercontent.com/5lb1EC5zNUPY2KBa0odFOXmuIKeSH4CES8dSbbb1lBUMwdwoJdoF4tuNdA4Vb_sJWZdLdeagos2Wofk2TqcZZ8MXcGwKDfhhq8tQiIPRuSxOYUQM2RLJzYpVKFiWIHDllw"></span></span><span style="color: rgb(0,0,0);">to</span><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh6.googleusercontent.com/v-7vDaIMWSn6D-EPvUfjJClMpza8hJNfUcBnVlHYMfQoBBYI96JBPTss9seuEuAbNFy_DioIIoSzcxpYrmMULciChgthw9Np9OuzNDMiBZKIFrlrJMG6lDzKVWIfATTfTQ" data-image-src="https://lh6.googleusercontent.com/v-7vDaIMWSn6D-EPvUfjJClMpza8hJNfUcBnVlHYMfQoBBYI96JBPTss9seuEuAbNFy_DioIIoSzcxpYrmMULciChgthw9Np9OuzNDMiBZKIFrlrJMG6lDzKVWIfATTfTQ"></span></span></p><p><span style="color: rgb(0,0,0);">MapJoinFactory SMB MapJoin processing:</span></p><p><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh6.googleusercontent.com/R3akhcjTnYUlBlScZbhlILMQKEzKX_lGd1wHQCL8z9F6PhIf_fODRcAHh2Z1vW0_5bEuHbnheKo0iPr7tX2jxHKzTGigXIm5BFb0mjt9jxJzh5_Ba0KzYHCGamopDnyGfQ" data-image-src="https://lh6.googleusercontent.com/R3akhcjTnYUlBlScZbhlILMQKEzKX_lGd1wHQCL8z9F6PhIf_fODRcAHh2Z1vW0_5bEuHbnheKo0iPr7tX2jxHKzTGigXIm5BFb0mjt9jxJzh5_Ba0KzYHCGamopDnyGfQ"></span></span><span style="color: rgb(0,0,0);">to </span><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh5.googleusercontent.com/O4IZC0pipupTQxh9dxFum1-sSVFOvKLQvSElXHScGShSLVpLftSSB1UT_FY7bxmkK2XfA_KuExUCDEYnM2Dsk7jw5LPJpmY_K5o9mmEvHvi6VE4CKzSIXYMtAHF_8ZuV2A" data-image-src="https://lh5.googleusercontent.com/O4IZC0pipupTQxh9dxFum1-sSVFOvKLQvSElXHScGShSLVpLftSSB1UT_FY7bxmkK2XfA_KuExUCDEYnM2Dsk7jw5LPJpmY_K5o9mmEvHvi6VE4CKzSIXYMtAHF_8ZuV2A"></span></span></p><ul><li><p><span>CommonJoinResolver:  This handles auto-conversions of joins to mapjoins and goes a separate path than hint-based mapjoin conversions.  This takes a working common-join work tree already generated from the common-join operator-tree, and creates an alternative work-tree.  The new work-tree consists of a mapwork rooted at the big table.  Pointers to the small table are retained in the new work via the LocalWork data structure.</span></p></li></ul><p> </p><p><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh4.googleusercontent.com/zd6-KZbQYo3Gw5YymR_lywLFbnLa78UdS9-oTH-uozqKulyuDSS1xFdo2SzFQPWFnqg7jSVWyQXiBp2ZDqaiKDZVyA293lQoOjXsTCMmmK925eIPasiTCnC2OXEiIfkODg" data-image-src="https://lh4.googleusercontent.com/zd6-KZbQYo3Gw5YymR_lywLFbnLa78UdS9-oTH-uozqKulyuDSS1xFdo2SzFQPWFnqg7jSVWyQXiBp2ZDqaiKDZVyA293lQoOjXsTCMmmK925eIPasiTCnC2OXEiIfkODg"></span></span><span style="color: rgb(0,0,0);">to: </span><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh6.googleusercontent.com/9O1QU47n5quyJ4gne3No9BvK8mREfDUOe2evjItRe6oZdPUBin9M4nrTPt2QaiJTaBEbzbJH68sp47I7gK2_NTQM9phVHnBhYbdUT0vTv6oHJ79CQRGAQk49GvuRD6D65A" data-image-src="https://lh6.googleusercontent.com/9O1QU47n5quyJ4gne3No9BvK8mREfDUOe2evjItRe6oZdPUBin9M4nrTPt2QaiJTaBEbzbJH68sp47I7gK2_NTQM9phVHnBhYbdUT0vTv6oHJ79CQRGAQk49GvuRD6D65A"></span></span></p><ul><li><p><span>MapJoinResolver:  Here, the two mapjoin paths (hint and non-hint mapjoins) unite again.  One last step for both results is to make it ready for physical execution on MR cluster, described in detail in below section “Spark MapJoin”.  The MapJoinResolver separates the single work into two works.  First a local MapRedWork dealing with small tables, ending with HashTableSink writing the hashmap files.  Then a MapRedWork dealing with big table, loading from small-table hashmap files via HashTableDummyOp.</span></p></li></ul><p><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh6.googleusercontent.com/lQIaQRRy1g1y6ke6bnbDOU2YJw_O1Zc9ayXYPyAZlvBp6EJwU8COq2T84vu0g5M-Mow_qId_4-BQZj6YqExUNKD4KNGGULSZIq7qZeMr1R4rgefkJ7eKQYxxXB3ti3yKFA" data-image-src="https://lh6.googleusercontent.com/lQIaQRRy1g1y6ke6bnbDOU2YJw_O1Zc9ayXYPyAZlvBp6EJwU8COq2T84vu0g5M-Mow_qId_4-BQZj6YqExUNKD4KNGGULSZIq7qZeMr1R4rgefkJ7eKQYxxXB3ti3yKFA"></span></span><span style="color: rgb(0,0,0);">to </span><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh5.googleusercontent.com/hxeqXQlbKmoqkaisHbEq3OY3NMPpm3WIqCkLb0zrt3XvJf66dzlEQCR9H5ZOO51ayx30IKI395gdcLS9FqOkF4e5DjZNY2j4bwG7TWKDIniizIDCRMArWGhe_y90iiUgcw" data-image-src="https://lh5.googleusercontent.com/hxeqXQlbKmoqkaisHbEq3OY3NMPpm3WIqCkLb0zrt3XvJf66dzlEQCR9H5ZOO51ayx30IKI395gdcLS9FqOkF4e5DjZNY2j4bwG7TWKDIniizIDCRMArWGhe_y90iiUgcw"></span></span></p><p><span style="color: rgb(0,0,0);">A brief summary of all the processor-paths of possible join plans shown in Figure 1:</span></p><ol><li><p><span> </span><span>Skewjoin (compile-time)</span></p></li><ol><li><p><span>SkewJoinOptimizer: From a common-join operator tree, creates two join operator-trees connected by union operator.  These will represent a join with skew key, and a join without it.</span></p></li><li><p><span>One or both reduce-side join might be converted to mapjoin by CommonJoinResolver, see auto-mapjoin for more details.</span></p></li></ol><li><p><span>Skewjoin (runtime)</span></p></li><ol><li><p><span>SkewJoinResolver:  Create conditional work after the original common-join work, which is a list of mapjoin works.  These will handle the skew keys.</span></p></li><li><p><span>MapJoinResolver: Final preparation for mapjoin works as described.</span></p></li></ol><li><p><span>Auto-mapjoin</span></p></li><ol><li><p><span>CommonJoinResolver:  Convert common-join operator tree to mapjoin operator-tree, with big/small table(s) identified on the Mapjoin operator, as described.</span></p></li><li><p><span>MapJoinResolver: Final preparation for mapjoin works as described.</span></p></li></ol><li><p><span>Map join query with hints</span></p></li><ol><li><p><span>MapJoinProcessor:  Convert common-join operator tree to mapjoin operator-tree, with big/small table(s) identified on the Mapjoin operator, as described.</span></p></li><li><p><span>MapJoinFactory: Adds localWork pointing to small tables in mapjoin work, as described.</span></p></li><li><p><span>MapJoinResolver:  Final preparation for mapjoin works as described.</span></p></li></ol><li><p><span>Bucket map join query with hints.</span></p></li><ol><li><p><span>MapJoinProcessor:  Convert common-join operator tree to mapjoin operator-tree, with big/small table(s) identified on the Mapjoin operator, as described.</span></p></li><li><p><span>BucketMapJoinProcessor:  Add bucketing information to MapJoin op.</span></p></li><li><p><span>MapJoinFactory: Adds localWork pointing to small tables in mapjoin work, as described.</span></p></li><li><p><span>MapJoinResolver:  Final preparation for mapjoin works as described.</span></p></li></ol><li><p><span>SMB join query with hints</span></p></li><ol><li><p><span>MapJoinProcessor:  Convert common-join operator tree to mapjoin operator-tree, with big/small table(s) identified on the Mapjoin operator, as described.</span></p></li><li><p><span>SortedBucketMapJoinProc:  Convert mapjoin operator-tree to SMBMapJoin operator-tree.  Add DummyOp to small-tables.</span></p></li><li><p><span>MapJoinFactory:  Adds localWork pointing to small tables in SMBMapjoin work, as described.</span></p></li><li><p><span>May be converted back to MapJoin (see #8 for details).</span></p></li></ol><li><p><span>Auto-SMB join</span></p></li><ol><li><p><span>SortedMergeBucketMapJoinProc: Convert mapjoin operator-tree to SMBMapJoin operator-tree.  Add DummyOp to small-tables.</span></p></li><li><p><span>MapJoinFactory:  Adds localWork pointing to small tables in SMBMapjoin work, as described.</span></p></li><li><p><span>May be converted to MapJoin (see #8 for details).</span></p></li></ol><li><p><span> </span><span>SMB join that converts to mapjoin</span></p></li><ol><li><p><span>SMBJoin operator-tree constructed as mentioned in #6, #7 above.</span></p></li><li><p><span>SortedMergeJoinResolver:  For each possible big-table candidate, create a mapjoin work.  These will have LocalWork data structures to keep track of small-tables.  Create ConditionalWork with all of these mapjoin works (with the original SMBJoin work as the backup task of each one), and the original SMBJoin work as the last option.</span></p></li><li><p><span>MapJoinResolver: For each mapjoin work created, final preparation as described.</span></p></li></ol></ol><h2 id="HiveonSpark:JoinDesignMaster-TezComparison"><span style="color: rgb(0,0,0);">Tez Comparison</span></h2><p><span style="color: rgb(0,0,0);">Hive on Tez is still evolving.  They currently disable all logical-optimizer processors, and use a processor called “ConvertJoinMapJoin” located in the work-generation phase.  It utilitzes stats annotated on the operator-tree to make some decisions as to what join to take.  It will directly create plans for the following joins:</span></p><ul><li><p><span>MapJoin</span></p></li><li><p><span>SMBJoin</span></p></li></ul><p><span style="color: rgb(0,0,0);">These look different than MapReduce plans, and are based on the Tez physical feature “broadcast-edge”.  See JIRA’s of those joins for more details.</span></p><h2 id="HiveonSpark:JoinDesignMaster-SparkMapJoin"><span style="color: rgb(0,0,0);">Spark MapJoin</span></h2><p> </p><p><span style="color: rgb(0,0,0);">For most of the joins for Hive on Spark, the overall execution will be similar to MR for the first cut.  Thus, a similar work-tree as in MR will be generated, though encapsulated in SparkWork(s) instead of MapRedWork(s).</span></p><p><span style="color: rgb(0,0,0);">One difference is implementation of mapjoin, which is worth spending some time discussing.  Recall the mapjoin work-tree in MapReduce:</span></p><p><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh3.googleusercontent.com/kOU9rPef4U2D8ugPv_RCfIIgCmbmOWZ1sftxUgycIVpr8kak6En9XZOCBHubOJhsZZjcrcgDfMXCYpScdOpx9tRHmORFG8661G9SMvOngBpFGY-yJRDIf9Zy_HDftQlUmg" data-image-src="https://lh3.googleusercontent.com/kOU9rPef4U2D8ugPv_RCfIIgCmbmOWZ1sftxUgycIVpr8kak6En9XZOCBHubOJhsZZjcrcgDfMXCYpScdOpx9tRHmORFG8661G9SMvOngBpFGY-yJRDIf9Zy_HDftQlUmg"></span></span></p><ol><li><p><span>Run the MapredLocalWork containing small-table(s)’ operator-tree, ending it with a HashTableSink op that dumps to file.  This is made into a distributed cache. </span></p></li><li><p><span>Run the MapWork for the big table, which will populate small-table hashmap from the distributed cache file using HashTableDummy’s loader.</span></p></li></ol><p><span style="color: rgb(0,0,0);">Spark mapjoin has a choice to take advantage of faster Spark functionality like broadcast-variable, or use something similar to distributed-cache.  A discussion for choosing MR-style distributed cache is given in “small-table broadcasting” document in <a href="https://issues.apache.org/jira/browse/HIVE-7613" class="external-link" rel="nofollow">HIVE-7613</a>, though broadcast-variable support might be added in future.  Here is the plan that we want.</span></p><p> </p><p><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh5.googleusercontent.com/0E0yZCzxLwhv-uYLypQy0DIOWck7SdiNZY-kjPd_Oui3YdxY623_CJrdCz1d-jv3Hl5JRaAKTOle8PX9MH1h8ifNVEITP40kp-KONMlVcUubEN9zCiZj0kgD9FWil7R3OA" data-image-src="https://lh5.googleusercontent.com/0E0yZCzxLwhv-uYLypQy0DIOWck7SdiNZY-kjPd_Oui3YdxY623_CJrdCz1d-jv3Hl5JRaAKTOle8PX9MH1h8ifNVEITP40kp-KONMlVcUubEN9zCiZj0kgD9FWil7R3OA"></span></span></p><ol><li><p><span>Run the small-table SparkWorks on Spark cluster, which dump to hashmap file (this is main difference with MR, as the small-table work is distributed).</span></p></li><li><p><span>Run the SparkWork for the big table on Spark cluster.  Mappers will lookup the small-table hashmap from the file using HashTableDummy’s loader.</span></p></li></ol><p><span style="color: rgb(0,0,0);">For bucket map-join, each bucket of each small table goes to a separate file, and each mapper of big-table loads the specific bucket-file(s) of corresponding buckets for each small table.</span></p><h2 id="HiveonSpark:JoinDesignMaster-SparkJoinDesign"><span style="color: rgb(0,0,0);">Spark Join Design</span></h2><p><span style="color: rgb(0,0,0);">Let’s redraw the processor diagram for Hive on Spark.  There are several other points to note in this section:</span></p><ul><li><p><span>Logical optimizers are mostly re-used from Hive on MapReduce, directly or slightly modified.</span></p></li><li><p><span>GenSparkWork is the first of the work-generator processors, which creates SparkWorks.</span></p></li></ul><p><span style="color: rgb(0,0,0);">There are also some minor differences (improvements) over original MapReduce, beyond the one mentioned in Spark MapJoin section.</span></p><ul><li><p><span>Hive on Spark supports automatic bucket mapjoin, which is not supported in MapReduce.  This is done in extra logic via SparkMapJoinOptimizer and SparkMapJoinResolver.</span></p></li><li><p><span>Hive on Spark’s SMB to MapJoin conversion path is simplified, by directly converting to MapJoin if eligible.</span></p></li></ul><h3 id="HiveonSpark:JoinDesignMaster-Figure2:JoinProcessorsforHiveonSpark"><span style="color: rgb(0,0,0);">Figure 2: Join Processors for Hive on Spark</span></h3><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" width="900" confluence-query-params="effects=border-simple,blur-border" src="../../download/attachments/50858744/image2015-1-12%2015_2_3729b5.png?version=1&amp;modificationDate=1421103796000&amp;api=v2&amp;effects=border-simple,blur-border" data-image-src="/confluence/download/attachments/50858744/image2015-1-12%2015%3A2%3A37.png?version=1&amp;modificationDate=1421103796000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="51183929" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2015-1-12 15:2:37.png" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="50858744" data-linked-resource-container-version="9"></span></p><p><span><span><br/></span></span></p><p><span style="color: rgb(0,0,0);">Again, we first explore some of the interesting processors:</span></p><p> </p><ul><li><p><span>SparkSortMergeJoinOptimizer: Like SortrtedBucketMapJoinProc, this logical optimization processor handles auto-conversion of common-join to SMB join operator-tree, for further processing.</span></p></li></ul><p> </p><p> </p><p><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh3.googleusercontent.com/vEyeVd9osItYVMQD9QdyW9Yhg_CTTcCWstOboqDAiNkLoEt096giFXXbJ6IRXXIPzuraJDuefpP8ZVjBPStR7n0VUYkNiNXxTuPkT2clFHjGQomwKQOyd8OlEZFmfFBiiQ" data-image-src="https://lh3.googleusercontent.com/vEyeVd9osItYVMQD9QdyW9Yhg_CTTcCWstOboqDAiNkLoEt096giFXXbJ6IRXXIPzuraJDuefpP8ZVjBPStR7n0VUYkNiNXxTuPkT2clFHjGQomwKQOyd8OlEZFmfFBiiQ"></span></span><span style="color: rgb(0,0,0);">to</span><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh6.googleusercontent.com/R3akhcjTnYUlBlScZbhlILMQKEzKX_lGd1wHQCL8z9F6PhIf_fODRcAHh2Z1vW0_5bEuHbnheKo0iPr7tX2jxHKzTGigXIm5BFb0mjt9jxJzh5_Ba0KzYHCGamopDnyGfQ" data-image-src="https://lh6.googleusercontent.com/R3akhcjTnYUlBlScZbhlILMQKEzKX_lGd1wHQCL8z9F6PhIf_fODRcAHh2Z1vW0_5bEuHbnheKo0iPr7tX2jxHKzTGigXIm5BFb0mjt9jxJzh5_Ba0KzYHCGamopDnyGfQ"></span></span></p><ul><li><p><span>SparkSortMergeMapJoinFactory:  This takes a MapWork with operator-tree already with a SMBMapJoin operator and big/small table(s) identified, and creates a LocalWork pointing at small tables.</span></p></li></ul><p><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh6.googleusercontent.com/UN6Bj_2uZZ7eSutia3T0xZ3xhsXy7VbxLbAOQeEwRQD5gAG9U4VgaFeqyIYq5r0szLRwliuEMHIBYaMJ6Ogx7S_qvQSfIceHC9MP80zvTJBgQs2S3bIYOwTtlCO8dm5reQ" data-image-src="https://lh6.googleusercontent.com/UN6Bj_2uZZ7eSutia3T0xZ3xhsXy7VbxLbAOQeEwRQD5gAG9U4VgaFeqyIYq5r0szLRwliuEMHIBYaMJ6Ogx7S_qvQSfIceHC9MP80zvTJBgQs2S3bIYOwTtlCO8dm5reQ"></span></span><span style="color: rgb(0,0,0);">to  </span><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh4.googleusercontent.com/MjkiEe6ND6tKcDXiwheTNuVpo_SWMqyp1c3HKOTQeYhc0hv6figAMMHaedyZQGMVD1uJ4uhsfkxZoGcdyic2wOXLv4YluTi2omBgulRphW9D9tdkNwtyhqKksQVL4_3-sg" data-image-src="https://lh4.googleusercontent.com/MjkiEe6ND6tKcDXiwheTNuVpo_SWMqyp1c3HKOTQeYhc0hv6figAMMHaedyZQGMVD1uJ4uhsfkxZoGcdyic2wOXLv4YluTi2omBgulRphW9D9tdkNwtyhqKksQVL4_3-sg"></span></span></p><ul><li><p><span>SparkMapJoinProcessor: Like MapJoinProcessor, this logical optimization processor handles initial conversion of common-join to mapjoin, for further-processing, when user has given hints to identify the small tables.  Final operator-tree is just a bit different than with MapReduce, with ReduceSinks of small table branch(es) still attached.</span></p></li></ul><p><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh3.googleusercontent.com/vEyeVd9osItYVMQD9QdyW9Yhg_CTTcCWstOboqDAiNkLoEt096giFXXbJ6IRXXIPzuraJDuefpP8ZVjBPStR7n0VUYkNiNXxTuPkT2clFHjGQomwKQOyd8OlEZFmfFBiiQ" data-image-src="https://lh3.googleusercontent.com/vEyeVd9osItYVMQD9QdyW9Yhg_CTTcCWstOboqDAiNkLoEt096giFXXbJ6IRXXIPzuraJDuefpP8ZVjBPStR7n0VUYkNiNXxTuPkT2clFHjGQomwKQOyd8OlEZFmfFBiiQ"></span></span><span style="color: rgb(0,0,0);">to</span><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh5.googleusercontent.com/nIUUtvmkxTXSo4YvC4iXxkJudeGOtYBfbTjalgjUPcTUC1fJbRcVC5jksG_YYKcPNhRrvMRWWVZm0CdyuNmKBL5M2seQMtLJXlaZvGj6JS9EMVeQWW8MUezcarrtSKE3mw" data-image-src="https://lh5.googleusercontent.com/nIUUtvmkxTXSo4YvC4iXxkJudeGOtYBfbTjalgjUPcTUC1fJbRcVC5jksG_YYKcPNhRrvMRWWVZm0CdyuNmKBL5M2seQMtLJXlaZvGj6JS9EMVeQWW8MUezcarrtSKE3mw"></span></span></p><p> </p><ul><li><p><span>SparkMapJoinOptimizer: Similar to MapReduce’s MapJoinProcessor and Tez’s ConvertJoinMapJoin, this will transform a common join operator-tree to a mapjoin operator-tree, by identifying the big and small tables via stats.  Like Tez’s processor, it removes the reduce-sinks from the big-table’s branch but keeps them for the small-tables.</span></p></li></ul><p><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh4.googleusercontent.com/V5rzrMpn5bldQNiHksNHlo2uyfp1Q5XhVEv5pF_-UCYhmQ0c2yjSDrPa3azrxbbdNqX6SCXmF-gVotVaJuL89oV4uja-dgjKT-3j-8xyJ-_oEOJoqiIqA33aq9pEFptHjw" data-image-src="https://lh4.googleusercontent.com/V5rzrMpn5bldQNiHksNHlo2uyfp1Q5XhVEv5pF_-UCYhmQ0c2yjSDrPa3azrxbbdNqX6SCXmF-gVotVaJuL89oV4uja-dgjKT-3j-8xyJ-_oEOJoqiIqA33aq9pEFptHjw"></span></span><span style="color: rgb(0,0,0);">to</span><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh4.googleusercontent.com/XyKZUOw8phFv1MsLsLOfPIHzIMnPxPe3RfMDtxGF0kCTF-qkejyV4tVsu9eI_n_ud54BRz5uYvFvOsb0SF9YogOYe45KRrFSrY1mJVw-3fv2SqndbKkREfFYeAojHSUEhw" data-image-src="https://lh4.googleusercontent.com/XyKZUOw8phFv1MsLsLOfPIHzIMnPxPe3RfMDtxGF0kCTF-qkejyV4tVsu9eI_n_ud54BRz5uYvFvOsb0SF9YogOYe45KRrFSrY1mJVw-3fv2SqndbKkREfFYeAojHSUEhw"></span></span></p><p><span><span><br/></span></span></p><ul><li><p><span>GenSparkWork/SparkReduceSinkMapJoinProc: During the work-generation phase, a combination of these processors will draw the appropriate work boundaries around the mapjoin operator tree.  It also transforms ReduceSinks into HashTableSinks.</span></p></li></ul><p><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh6.googleusercontent.com/BPzPNEF0N801KCIoZKYwu9XvVXsroUodOxaGV1vPcHWlW6Cs62NHkQau5C9SexoOMJRMVzMPnDPqaiZ54ZnU60aN7h33J3gK5AVE08Cgz_Kow5vxlM3MW789vSR4Z1cu4Q" data-image-src="https://lh6.googleusercontent.com/BPzPNEF0N801KCIoZKYwu9XvVXsroUodOxaGV1vPcHWlW6Cs62NHkQau5C9SexoOMJRMVzMPnDPqaiZ54ZnU60aN7h33J3gK5AVE08Cgz_Kow5vxlM3MW789vSR4Z1cu4Q"></span></span><span style="color: rgb(0,0,0);">to</span><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh3.googleusercontent.com/McqEtWtWDoyvf8ZRv-7LCR0QGTVhx2yGZBrUfE4JSQbOjdHPilZGh96PAHyaVstdQKBESBt4BaY8XIp8unhpV515i9B1uz_49D9naCJfcltBpTyDJ_iGzrT0bg5mEDn3Wg" data-image-src="https://lh3.googleusercontent.com/McqEtWtWDoyvf8ZRv-7LCR0QGTVhx2yGZBrUfE4JSQbOjdHPilZGh96PAHyaVstdQKBESBt4BaY8XIp8unhpV515i9B1uz_49D9naCJfcltBpTyDJ_iGzrT0bg5mEDn3Wg"></span></span></p><p><span><span><br/></span></span></p><ul><li><p><span>SparkMapJoinResolver: Again, the various mapjoin paths (hint and automatic) converge at this final processor before execution on Spark cluster.  This takes a single SparkWork with MapJoin operator and big/small table(s) identified, and splits it into dependent SparkWorks, with the small-table SparkWork(s) being parents of the big-table SparkWork.  This will be sent to Spark cluster to run mapjoin as described in the section “Spark MapJoin”.  The LocalWork data structure is created within the dependent (big-table) SparkWork to contain HashTableDummy’s which load small-table hashmap files.</span></p></li></ul><p> </p><p><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh3.googleusercontent.com/OmwdjBXH8Uw6pBvi2OGQkZ301TkHzmfzhuMV9fOL1czSQeip_cCgbg-ihUd-KKxwwJJurkFQCZeQbFyrLWAiUX2Ry0uWPUKmxinG1YKvJ7FfgjYjpXyeaLCE4nmp24pmlA" data-image-src="https://lh3.googleusercontent.com/OmwdjBXH8Uw6pBvi2OGQkZ301TkHzmfzhuMV9fOL1czSQeip_cCgbg-ihUd-KKxwwJJurkFQCZeQbFyrLWAiUX2Ry0uWPUKmxinG1YKvJ7FfgjYjpXyeaLCE4nmp24pmlA"></span></span><span style="color: rgb(0,0,0);">to: </span><span style="color: rgb(0,0,0);"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="https://lh4.googleusercontent.com/k9YPLYJSaULuwfmHZY3Y50QhLYE91BN5NTPUoHqEKzkE6xihEH66aSIIgE30Ay2TWfnqkJBnK7cTnKjif06SZZ_sLK44frnebWFRw4wNh-Sz05HQDrfQ9_4HNYHb94jncA" data-image-src="https://lh4.googleusercontent.com/k9YPLYJSaULuwfmHZY3Y50QhLYE91BN5NTPUoHqEKzkE6xihEH66aSIIgE30Ay2TWfnqkJBnK7cTnKjif06SZZ_sLK44frnebWFRw4wNh-Sz05HQDrfQ9_4HNYHb94jncA"></span></span></p><p> </p><p><span style="color: rgb(0,0,0);">And the summary of each join plan’s processor path of Figure 2.</span></p><ol><li><p><span>Compile-time skewjoin without mapjoin: Logical optimizer completely re-used from MapReduce.</span></p></li><ol><li><p><span>SkewJoinOptimizer: This logical-optimizer processor is reused, to create two join plans out of one connected by union.</span></p></li><li><p><span>Follows auto-conversion to MapJoin path.</span></p></li></ol><li><p><span>SMB MapJoin (with hints): again, logical optimizers are mostly similar to those in MapReduce.</span></p></li><ol><li><p><span>SparkMapJoinProcessor/BucketMapJoinOptimizer/SparkSMBJoinHintOptimizer: Almost identical to MapReduce versions, these transform the operator tree to include SMBMapJoinOp with big/small table(s) identified.</span></p></li><li><p><span>GenSparkWork:  Generate the SparkWork, which is an SMBMapJoin operator-tree rooted at big-table TS.</span></p></li><li><p><span>SparkSortMergeJoinFactory: Attach Localwork data structure pointing to small tables in the SMBMapJoin work as described.</span></p></li></ol><li><p><span>SMB MapJoin (without hints): again, logical optimizers are mostly similar to those in MapReduce</span></p></li><ol><li><p><span>SparkSortMergeJoinOptimizer: Almost identical to MapReduce version, this transforms the common-join operator tree to SMB mapjoin operator-tree, with big/small table(s) identified on SMBMapJoin operator, as described.</span></p></li><li><p><span>GenSparkWork:  Generate the SparkWork, which is an SMBMapJoin operator-tree rooted at big-table TS.</span></p></li><li><p><span>SparkSortMergeJoinFactory: Attach Localwork data structure pointing to small tables in the SMBMapJoin work as described.</span></p></li></ol><li><p><span>Auto-mapjoin:  Mostly a rewrite, unable to reuse the MapReduce processors.</span></p></li><ol><li><p><span>SparkMapJoinOptimizer:  Based on stats, converts a common-join operator tree to mapjoin operator-tree, with big/small table(s) identified in MapJoinOp, as described.</span></p></li><li><p><span>GenSparkWork:  Generate the SparkWork, which has MapJoin operator-trees rooted at various table TS’s.</span></p></li><li><p><span>SparkMapJoinResolver: Create two SparkWorks to achieve the mapjoin, as described.</span></p></li></ol><li><p><span>Mapjoin via hints: again, logical optimizers are mostly similar to those in MapReduce</span></p></li><ol><li><p><span>SparkMapJoinProcessor: Almost identical to MapReduce version, this transforms the common-join operator tree to mapjoin operator-tree, with big/small table(s) identified in MapJoinOp, as described.</span></p></li><li><p><span>GenSparkWork:   Generate the SparkWork, which has MapJoin operator-trees rooted at various table TS’s.</span></p></li><li><p><span>SparkMapJoinResolver: Create two SparkWorks to achieve the mapjoin, as described.</span></p></li></ol><li><p><span>SMB joins converted to mapjoin:</span></p></li><ol><li><p><span>This route is avoided unlike in MapReduce.  If conditions are met, join is directly sent to SparkMapJoinOptimizer and SparkMapJoinResolver, just like a normal auto-mapjoin.</span></p></li></ol><li><p><span>Skew join (runtime):</span></p></li><ol><li><p><span>SparkSkewJoinResolver:  Takes a SparkWork with common join, and turn it in a conditional work.  Then add additional SparkWork with mapjoin operator-tree as backups in the conditional work.  These will handle the skew keys.</span></p></li><li><p><span>SparkMapJoinResolver:  For each backup SparkWork with mapjoin, create two SparkWorks to achieve the mapjoin, as described.</span></p></li></ol><li><p><span>Auto-bucket join</span></p></li><ol><li><p><span>SparkMapJoinOptimizer:  Extra logic here beyond auto-mapjoin conversion to support auto-bucket mapjoin conversion.</span></p></li><li><p><span>SparkMapJoinResolver:  Extra logic here beyond auto-mapjoin conversion to support auto-bucket mapjoin conversion.</span></p></li></ol></ol>

                
        
    
        </div>

                        
    



<div id="labels-section" class="pageSection group">
    <div class="labels-section-content content-column" entityid="50858744" entitytype="page">
	<div class="labels-content">
		
    <ul class="label-list label-list-right ">
            <li class="no-labels-message">
            No labels
        </li>
            </ul>

    </div>
</div>
</div>
        
		
            




            
        








                        
    
<div id="comments-section" class="pageSection group">
        
    



</div>
        


                
    
            
</div>

    

    




    
    

    
    
    


    
<div id="space-tools-web-items" class="hidden">
                <div data-label="Overview" data-href="/confluence/spaces/viewspacesummary.action?key=Hive">Overview</div>
            <div data-label="Content Tools" data-href="/confluence/pages/reorderpages.action?key=Hive">Content Tools</div>
            <div data-label="Apps" data-href="/confluence/spaces/snippeterrors.action?key=Hive">Apps</div>
    </div>
        



            </div><!-- \#main -->
            
    
    
        
            
            

<div id="footer" role="contentinfo">
    <section class="footer-body">

                                                            <p class="license license-opensource">
                    Powered by a free <b>Atlassian Confluence Open Source Project License</b> granted to Apache Software Foundation. <a href="https://www.atlassian.com/software/views/opensource-community-additional-license-offer">Evaluate Confluence today</a>.<br>
                </p>
                    
        

        <ul id="poweredby">
            <li class="noprint">Powered by <a href="http://www.atlassian.com/software/confluence" class="hover-footer-link" rel="nofollow">Atlassian Confluence</a> <span id='footer-build-information'>7.13.2</span></li>
            <li class="print-only">Printed by Atlassian Confluence 7.13.2</li>
            <li class="noprint"><a href="https://support.atlassian.com/help/confluence" class="hover-footer-link" rel="nofollow">Report a bug</a></li>
            <li class="noprint"><a href="https://www.atlassian.com/company" class="hover-footer-link" rel="nofollow">Atlassian News</a></li>
        </ul>

        

        <div id="footer-logo"><a href="http://www.atlassian.com/" rel="nofollow">Atlassian</a></div>

                    
        
    </section>
</div>

    
</div>

</div><!-- \#full-height-container -->
</div><!-- \#page -->

    <span style="display:none;" id="confluence-server-performance">{"serverDuration": 98, "requestCorrelationId": "a0c3e294f56b9439"}</span>
</body>

<!-- Mirrored from cwiki.apache.org/confluence/display/Hive/Hive+on+Spark%3A+Join+Design+Master by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 15 Dec 2021 19:44:09 GMT -->
</html>
    

    

<!DOCTYPE html>
<html lang="en-GB" >

<!-- Mirrored from cwiki.apache.org/confluence/display/Hive/Hive+Transactions by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 15 Dec 2021 19:40:50 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
                            <title>Hive Transactions - Apache Hive - Apache Software Foundation</title>
    
        

                        
    
                        
    

                
    
    <meta http-equiv="X-UA-Compatible" content="IE=EDGE,chrome=IE7">
<meta charset="UTF-8">
<meta id="confluence-context-path" name="confluence-context-path" content="/confluence">
<meta id="confluence-base-url" name="confluence-base-url" content="https://cwiki.apache.org/confluence">

    <meta id="atlassian-token" name="atlassian-token" content="d7833c7da397e2f88a76912a1879e0225325829d">


<meta id="confluence-space-key" name="confluence-space-key" content="Hive">
<script type="text/javascript">
        var contextPath = '/confluence';
</script>

    

    <meta name="confluence-request-time" content="1639597140396">
        
    
        
            <meta name="ajs-use-keyboard-shortcuts" content="true">
            <meta name="ajs-is-confluence-admin" content="false">
            <meta name="ajs-connection-timeout" content="10000">
            <script type="text/x-template" title="gliffy-webpanel-footer">
        <div class="gliffy-webpanel-footer"><span>This Confluence installation runs a Free Gliffy License - Evaluate the <a href="http://www.gliffy.com/products/confluence-plugin/">Gliffy Confluence Plugin</a> for your Wiki!</span></div>
</script>


            <style>.ia-fixed-sidebar, .ia-splitter-left {width: 285px;}.theme-default .ia-splitter #main {margin-left: 285px;}.ia-fixed-sidebar {visibility: hidden;}</style>
            <meta name="ajs-discovered-plugin-features" content="$discoveredList">
            <meta name="ajs-keyboardshortcut-hash" content="f372abdc7d1a6481c736efc7686d149c">
            <meta id="team-calendars-has-jira-link" content="true">
            <meta name="ajs-team-calendars-display-time-format" content="displayTimeFormat12">
            <meta id="team-calendars-display-week-number" content="false">
            <meta id="team-calendars-user-timezone" content="Etc/UTC">
            <script type="text/x-template" id="team-calendars-messages" title="team-calendars-messages"><fieldset class="i18n hidden"><input type="hidden" name="calendar3.month.long.july" value="July"><input type="hidden" name="calendar3.day.short.wednesday" value="Wed"><input type="hidden" name="calendar3.day.short.thursday" value="Thu"><input type="hidden" name="calendar3.month.short.march" value="Mar"><input type="hidden" name="calendar3.month.long.april" value="April"><input type="hidden" name="calendar3.month.long.october" value="October"><input type="hidden" name="calendar3.month.long.august" value="August"><input type="hidden" name="calendar3.month.short.july" value="Jul"><input type="hidden" name="calendar3.month.short.may" value="May"><input type="hidden" name="calendar3.month.short.november" value="Nov"><input type="hidden" name="calendar3.day.long.friday" value="Friday"><input type="hidden" name="calendar3.day.long.sunday" value="Sunday"><input type="hidden" name="calendar3.day.long.saturday" value="Saturday"><input type="hidden" name="calendar3.month.short.april" value="Apr"><input type="hidden" name="calendar3.day.long.wednesday" value="Wednesday"><input type="hidden" name="calendar3.month.long.december" value="December"><input type="hidden" name="calendar3.month.short.october" value="Oct"><input type="hidden" name="calendar3.day.long.monday" value="Monday"><input type="hidden" name="calendar3.month.short.june" value="Jun"><input type="hidden" name="calendar3.day.short.monday" value="Mon"><input type="hidden" name="calendar3.day.short.tuesday" value="Tue"><input type="hidden" name="calendar3.day.short.saturday" value="Sat"><input type="hidden" name="calendar3.month.long.march" value="March"><input type="hidden" name="calendar3.month.long.june" value="June"><input type="hidden" name="calendar3.month.short.february" value="Feb"><input type="hidden" name="calendar3.month.short.august" value="Aug"><input type="hidden" name="calendar3.month.short.december" value="Dec"><input type="hidden" name="calendar3.day.short.sunday" value="Sun"><input type="hidden" name="calendar3.month.long.february" value="February"><input type="hidden" name="calendar3.day.long.tuesday" value="Tuesday"><input type="hidden" name="calendar3.month.long.may" value="May"><input type="hidden" name="calendar3.month.long.september" value="September"><input type="hidden" name="calendar3.month.long.november" value="November"><input type="hidden" name="calendar3.month.short.january" value="Jan"><input type="hidden" name="calendar3.month.short.september" value="Sep"><input type="hidden" name="calendar3.day.long.thursday" value="Thursday"><input type="hidden" name="calendar3.month.long.january" value="January"><input type="hidden" name="calendar3.day.short.friday" value="Fri"></fieldset></script>
            
    
    
            <meta name="ajs-page-title" content="Hive Transactions">
            <meta name="ajs-latest-published-page-title" content="Hive Transactions">
            <meta name="ajs-space-name" content="Apache Hive">
            <meta name="ajs-page-id" content="40509723">
            <meta name="ajs-latest-page-id" content="40509723">
            <meta name="ajs-content-type" content="page">
            <meta name="ajs-parent-page-title" content="Home">
            <meta name="ajs-parent-page-id" content="27362069">
            <meta name="ajs-space-key" content="Hive">
            <meta name="ajs-max-number-editors" content="12">
            <meta name="ajs-macro-placeholder-timeout" content="5000">
            <meta name="ajs-jira-metadata-count" content="1">
            <meta name="ajs-jira-metadata-count-incomplete" content="false">
            <meta name="ajs-from-page-title" content="">
            <meta name="ajs-can-remove-page" content="false">
            <meta name="ajs-can-remove-page-hierarchy" content="false">
            <meta name="ajs-browse-page-tree-mode" content="view">
            <meta name="ajs-shared-drafts" content="true">
            <meta name="ajs-context-path" content="/confluence">
            <meta name="ajs-base-url" content="https://cwiki.apache.org/confluence">
            <meta name="ajs-version-number" content="7.13.2">
            <meta name="ajs-build-number" content="8703">
            <meta name="ajs-remote-user" content="">
            <meta name="ajs-remote-user-key" content="">
            <meta name="ajs-remote-user-has-licensed-access" content="false">
            <meta name="ajs-remote-user-has-browse-users-permission" content="false">
            <meta name="ajs-current-user-fullname" content="">
            <meta name="ajs-current-user-avatar-url" content="">
            <meta name="ajs-current-user-avatar-uri-reference" content="/confluence/images/icons/profilepics/anonymous.svg">
            <meta name="ajs-static-resource-url-prefix" content="/confluence/s/6dvx22/8703/4mhn8a/_">
            <meta name="ajs-global-settings-attachment-max-size" content="20971520">
            <meta name="ajs-global-settings-quick-search-enabled" content="true">
            <meta name="ajs-user-locale" content="en_GB">
            <meta name="ajs-enabled-dark-features" content="site-wide.shared-drafts,site-wide.synchrony,clc.quick.create,confluence.view.edit.transition,cql.search.screen,confluence-inline-comments-resolved,frontend.editor.v4,http.session.registrar,nps.survey.inline.dialog,confluence.efi.onboarding.new.templates,frontend.editor.v4.compatibility,atlassian.cdn.static.assets,pdf-preview,previews.sharing,previews.versions,file-annotations,confluence.efi.onboarding.rich.space.content,collaborative-audit-log,confluence.reindex.improvements,previews.conversion-service,editor.ajax.save,read.only.mode,graphql,previews.trigger-all-file-types,attachment.extracted.text.extractor,lucene.caching.filter,confluence.table.resizable,notification.batch,previews.sharing.pushstate,confluence-inline-comments-rich-editor,tc.tacca.dacca,site-wide.synchrony.opt-in,file-annotations.likes,gatekeeper-ui-v2,v2.content.name.searcher,mobile.supported.version,pulp,confluence-inline-comments,confluence-inline-comments-dangling-comment,quick-reload-inline-comments-flags">
            <meta name="ajs-atl-token" content="d7833c7da397e2f88a76912a1879e0225325829d">
            <meta name="ajs-confluence-flavour" content="VANILLA">
            <meta name="ajs-user-date-pattern" content="dd MMM yyyy">
            <meta name="ajs-access-mode" content="READ_WRITE">
            <meta name="ajs-render-mode" content="READ_WRITE">
            <meta name="ajs-date.format" content="MMM dd, yyyy">
    
    <link rel="shortcut icon" href="https://cwiki.apache.org/confluence/s/6dvx22/8703/4mhn8a/1/_/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://cwiki.apache.org/confluence/s/6dvx22/8703/4mhn8a/1/_/favicon.ico">

<link rel="search" type="application/opensearchdescription+xml" href="https://cwiki.apache.org/confluence/opensearch/osd.action" title="Apache Software Foundation"/>
    
                    
            <meta name="ajs-create-issue-metadata-show-discovery" content="false">
            

    <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\u0022\u005C/confluence\u0022";
WRM._unparsedData["com.atlassian.confluence.plugins.confluence-feature-discovery-plugin:confluence-feature-discovery-plugin-resources.test-mode"]="false";
WRM._unparsedData["com.atlassian.confluence.plugins.synchrony-interop:synchrony-status-banner-loader.synchrony-status"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["com.atlassian.applinks.applinks-plugin:applinks-common-exported.applinks-help-paths"]="{\u0022entries\u0022:{\u0022applinks.docs.root\u0022:\u0022https://confluence.atlassian.com/display/APPLINKS-072/\u0022,\u0022applinks.docs.diagnostics.troubleshoot.sslunmatched\u0022:\u0022SSL+and+application+link+troubleshooting+guide\u0022,\u0022applinks.docs.diagnostics.troubleshoot.oauthsignatureinvalid\u0022:\u0022OAuth+troubleshooting+guide\u0022,\u0022applinks.docs.diagnostics.troubleshoot.oauthtimestamprefused\u0022:\u0022OAuth+troubleshooting+guide\u0022,\u0022applinks.docs.delete.entity.link\u0022:\u0022Create+links+between+projects\u0022,\u0022applinks.docs.adding.application.link\u0022:\u0022Link+Atlassian+applications+to+work+together\u0022,\u0022applinks.docs.administration.guide\u0022:\u0022Application+Links+Documentation\u0022,\u0022applinks.docs.oauth.security\u0022:\u0022OAuth+security+for+application+links\u0022,\u0022applinks.docs.troubleshoot.application.links\u0022:\u0022Troubleshoot+application+links\u0022,\u0022applinks.docs.diagnostics.troubleshoot.unknownerror\u0022:\u0022Network+and+connectivity+troubleshooting+guide\u0022,\u0022applinks.docs.configuring.auth.trusted.apps\u0022:\u0022Configuring+Trusted+Applications+authentication+for+an+application+link\u0022,\u0022applinks.docs.diagnostics.troubleshoot.authlevelunsupported\u0022:\u0022OAuth+troubleshooting+guide\u0022,\u0022applinks.docs.diagnostics.troubleshoot.ssluntrusted\u0022:\u0022SSL+and+application+link+troubleshooting+guide\u0022,\u0022applinks.docs.diagnostics.troubleshoot.unknownhost\u0022:\u0022Network+and+connectivity+troubleshooting+guide\u0022,\u0022applinks.docs.delete.application.link\u0022:\u0022Link+Atlassian+applications+to+work+together\u0022,\u0022applinks.docs.adding.project.link\u0022:\u0022Configuring+Project+links+across+Applications\u0022,\u0022applinks.docs.link.applications\u0022:\u0022Link+Atlassian+applications+to+work+together\u0022,\u0022applinks.docs.diagnostics.troubleshoot.oauthproblem\u0022:\u0022OAuth+troubleshooting+guide\u0022,\u0022applinks.docs.diagnostics.troubleshoot.migration\u0022:\u0022Update+application+links+to+use+OAuth\u0022,\u0022applinks.docs.relocate.application.link\u0022:\u0022Link+Atlassian+applications+to+work+together\u0022,\u0022applinks.docs.administering.entity.links\u0022:\u0022Create+links+between+projects\u0022,\u0022applinks.docs.upgrade.application.link\u0022:\u0022OAuth+security+for+application+links\u0022,\u0022applinks.docs.diagnostics.troubleshoot.connectionrefused\u0022:\u0022Network+and+connectivity+troubleshooting+guide\u0022,\u0022applinks.docs.configuring.auth.oauth\u0022:\u0022OAuth+security+for+application+links\u0022,\u0022applinks.docs.insufficient.remote.permission\u0022:\u0022OAuth+security+for+application+links\u0022,\u0022applinks.docs.configuring.application.link.auth\u0022:\u0022OAuth+security+for+application+links\u0022,\u0022applinks.docs.diagnostics\u0022:\u0022Application+links+diagnostics\u0022,\u0022applinks.docs.configured.authentication.types\u0022:\u0022OAuth+security+for+application+links\u0022,\u0022applinks.docs.adding.entity.link\u0022:\u0022Create+links+between+projects\u0022,\u0022applinks.docs.diagnostics.troubleshoot.unexpectedresponse\u0022:\u0022Network+and+connectivity+troubleshooting+guide\u0022,\u0022applinks.docs.configuring.auth.basic\u0022:\u0022Configuring+Basic+HTTP+Authentication+for+an+Application+Link\u0022,\u0022applinks.docs.diagnostics.troubleshoot.authlevelmismatch\u0022:\u0022OAuth+troubleshooting+guide\u0022}}";
WRM._unparsedData["com.atlassian.applinks.applinks-plugin:applinks-common-exported.applinks-types"]="{\u0022crowd\u0022:\u0022Crowd\u0022,\u0022confluence\u0022:\u0022Confluence\u0022,\u0022fecru\u0022:\u0022FishEye / Crucible\u0022,\u0022stash\u0022:\u0022Stash\u0022,\u0022jira\u0022:\u0022Jira\u0022,\u0022refapp\u0022:\u0022Reference Application\u0022,\u0022bamboo\u0022:\u0022Bamboo\u0022,\u0022generic\u0022:\u0022Generic Application\u0022}";
WRM._unparsedData["com.atlassian.applinks.applinks-plugin:applinks-common-exported.entity-types"]="{\u0022singular\u0022:{\u0022refapp.charlie\u0022:\u0022Charlie\u0022,\u0022fecru.project\u0022:\u0022Crucible Project\u0022,\u0022fecru.repository\u0022:\u0022FishEye Repository\u0022,\u0022stash.project\u0022:\u0022Stash Project\u0022,\u0022generic.entity\u0022:\u0022Generic Project\u0022,\u0022confluence.space\u0022:\u0022Confluence Space\u0022,\u0022bamboo.project\u0022:\u0022Bamboo Project\u0022,\u0022jira.project\u0022:\u0022Jira Project\u0022},\u0022plural\u0022:{\u0022refapp.charlie\u0022:\u0022Charlies\u0022,\u0022fecru.project\u0022:\u0022Crucible Projects\u0022,\u0022fecru.repository\u0022:\u0022FishEye Repositories\u0022,\u0022stash.project\u0022:\u0022Stash Projects\u0022,\u0022generic.entity\u0022:\u0022Generic Projects\u0022,\u0022confluence.space\u0022:\u0022Confluence Spaces\u0022,\u0022bamboo.project\u0022:\u0022Bamboo Projects\u0022,\u0022jira.project\u0022:\u0022Jira Projects\u0022}}";
WRM._unparsedData["com.atlassian.applinks.applinks-plugin:applinks-common-exported.authentication-types"]="{\u0022com.atlassian.applinks.api.auth.types.BasicAuthenticationProvider\u0022:\u0022Basic Access\u0022,\u0022com.atlassian.applinks.api.auth.types.TrustedAppsAuthenticationProvider\u0022:\u0022Trusted Applications\u0022,\u0022com.atlassian.applinks.api.auth.types.CorsAuthenticationProvider\u0022:\u0022CORS\u0022,\u0022com.atlassian.applinks.api.auth.types.OAuthAuthenticationProvider\u0022:\u0022OAuth\u0022,\u0022com.atlassian.applinks.api.auth.types.TwoLeggedOAuthAuthenticationProvider\u0022:\u0022OAuth\u0022,\u0022com.atlassian.applinks.api.auth.types.TwoLeggedOAuthWithImpersonationAuthenticationProvider\u0022:\u0022OAuth\u0022}";
WRM._unparsedData["com.atlassian.confluence.plugins.confluence-license-banner:confluence-license-banner-resources.license-details"]="{\u0022daysBeforeLicenseExpiry\u0022:0,\u0022daysBeforeMaintenanceExpiry\u0022:0,\u0022showLicenseExpiryBanner\u0022:false,\u0022showMaintenanceExpiryBanner\u0022:false,\u0022renewUrl\u0022:null,\u0022salesUrl\u0022:null}";
WRM._unparsedData["com.atlassian.confluence.plugins.confluence-search-ui-plugin:confluence-search-ui-plugin-resources.i18n-data"]="{\u0022search.ui.recent.link.text\u0022:\u0022View more recently visited\u0022,\u0022search.ui.filter.space.category.input.label\u0022:\u0022Find space categories...\u0022,\u0022search.ui.search.results.empty\u0022:\u0022We couldn\u005Cu0027\u005Cu0027t find anything matching \u005C\u0022{0}\u005C\u0022.\u0022,\u0022search.ui.filter.clear.selected\u0022:\u0022Clear selected items\u0022,\u0022search.ui.content.name.search.items.panel.load.all.top.items.button.text\u0022:\u0022Show more app results...\u0022,\u0022search.ui.filter.space.archive.label\u0022:\u0022Search archived spaces\u0022,\u0022search.ui.filter.label\u0022:\u0022filter\u0022,\u0022search.ui.filter.contributor.button.text\u0022:\u0022Contributor\u0022,\u0022search.ui.filter.date.all.text\u0022:\u0022Any time\u0022,\u0022search.ui.filter.space.current.label\u0022:\u0022CURRENT\u0022,\u0022search.ui.clear.input.button.text\u0022:\u0022Clear text\u0022,\u0022search.ui.search.results.clear.button\u0022:\u0022clear your filters.\u0022,\u0022search.ui.filter.date.hour.text\u0022:\u0022The past day\u0022,\u0022help.search.ui.link.title\u0022:\u0022Search tips\u0022,\u0022search.ui.filters.heading\u0022:\u0022Filter by\u0022,\u0022search.ui.filter.label.input.label\u0022:\u0022Find labels...\u0022,\u0022search.ui.recent.items.anonymous\u0022:\u0022Start exploring. Your search results will appear here.\u0022,\u0022search.ui.filter.date.month.text\u0022:\u0022The past month\u0022,\u0022search.ui.input.label\u0022:\u0022Search\u0022,\u0022search.ui.search.result\u0022:\u0022{0,choice,1#{0} search result|1\u005Cu003c{0} search results}\u0022,\u0022search.ui.infinite.scroll.button.text\u0022:\u0022More results\u0022,\u0022search.ui.filter.date.button.text\u0022:\u0022Date\u0022,\u0022search.ui.filter.date.week.text\u0022:\u0022The past week\u0022,\u0022search.ui.filter.label.button.text\u0022:\u0022Label\u0022,\u0022search.ui.input.alert\u0022:\u0022Hit enter to search\u0022,\u0022search.ui.result.subtitle.calendar\u0022:\u0022Team calendar\u0022,\u0022search.ui.filter.no.result.text\u0022:\u0022We can\u005Cu0027\u005Cu0027t find anything matching your search\u0022,\u0022search.ui.filter.date.heading\u0022:\u0022Last modified within\u0022,\u0022search.ui.result.subtitle.user\u0022:\u0022User profile\u0022,\u0022search.ui.filter.contributor.input.label\u0022:\u0022Find people...\u0022,\u0022search.ui.filter.content.type.button.text\u0022:\u0022Type\u0022,\u0022search.ui.filter.space.input.label\u0022:\u0022Find spaces...\u0022,\u0022search.ui.filter.date.year.text\u0022:\u0022The past year\u0022,\u0022search.ui.advanced.search.link.text\u0022:\u0022Advanced search\u0022,\u0022search.ui.filter.space.button.text\u0022:\u0022Space\u0022,\u0022search.ui.generic.error\u0022:\u0022Something went wrong. Refresh the page, or contact your admin if this keeps happening.\u0022,\u0022search.ui.recent.spaces\u0022:\u0022Recent Spaces\u0022,\u0022search.ui.search.results.clear.line2\u0022:\u0022Try a different search term or\u0022,\u0022search.ui.filter.space.category.button.text\u0022:\u0022Space category\u0022,\u0022search.ui.search.results.clear.line1\u0022:\u0022We couldn\u005Cu0027\u005Cu0027t find anything matching your search.\u0022,\u0022search.ui.content.name.search.items.panel.load.all.top.items.admin.button.text\u0022:\u0022Show more settings and app results...\u0022,\u0022search.ui.recent.pages\u0022:\u0022Recently visited\u0022,\u0022search.ui.search.result.anonymous\u0022:\u0022{0,choice,1#{0} search result|1\u005Cu003c{0} search results}. Have an account? {1}Log in{2} to expand your search.\u0022,\u0022search.ui.recent.items.empty\u0022:\u0022Start exploring. Pages and spaces you\u005Cu0027\u005Cu0027ve visited recently will appear here.\u0022,\u0022search.ui.result.subtitle.space\u0022:\u0022Space\u0022,\u0022search.ui.filter.space.init.heading\u0022:\u0022recent spaces\u0022}";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script>
<link type="text/css" rel="stylesheet" href="../../s/ad0cdaf669e3a7800fb6fa6452e260e4-CDN/6dvx22/8703/4mhn8a/6b1577085985a611eea3c1e80e0e7e93/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all">
<link type="text/css" rel="stylesheet" href="../../s/585884a9f3984b0aaecef0baf40c1e6e-CDN/6dvx22/8703/4mhn8a/e6aaebbd7baa9a045ec96374ae08d3b2/_/download/contextbatch/css/atl.confluence.plugins.pagetree-desktop%2cmain%2cvi/batch1203.css?gatekeeper-ui-v2=true&amp;highlightactions=true&amp;hostenabled=true" data-wrm-key="atl.confluence.plugins.pagetree-desktop,main,viewcontent,atl.general,page,atl.comments,-_super" data-wrm-batch-type="context" media="all">
<script type="text/javascript" src="../../s/58e418cc99c782d6bf891d0ee81d3e82-CDN/6dvx22/8703/4mhn8a/6b1577085985a611eea3c1e80e0e7e93/_/download/contextbatch/js/_super/batch6116.js?locale=en-GB" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script>
<script type="text/javascript" src="../../s/d8f9091841663d4e3446e48379e476f1-CDN/6dvx22/8703/4mhn8a/e6aaebbd7baa9a045ec96374ae08d3b2/_/download/contextbatch/js/atl.confluence.plugins.pagetree-desktop%2cmain%2cvi/batch3a32.js?gatekeeper-ui-v2=true&amp;highlightactions=true&amp;hostenabled=true&amp;locale=en-GB" data-wrm-key="atl.confluence.plugins.pagetree-desktop,main,viewcontent,atl.general,page,atl.comments,-_super" data-wrm-batch-type="context" data-initially-rendered></script>

    

        
    

        
        <meta name="ajs-site-title" content="Apache Software Foundation" />
            
    

    
                <link rel="canonical" href="Hive%2bTransactions.html">
        <link rel="shortlink" href="https://cwiki.apache.org/confluence/x/GyFqAg">
    <meta name="wikilink" content="[Hive:Hive Transactions]">
    <meta name="page-version" content="94">
    <meta name="ajs-page-version" content="94">

</head>

    
<body      id="com-atlassian-confluence" class="theme-default  aui-layout aui-theme-default">

        
            

<fieldset class="parameters hidden" style="display: none;">
            <input type="hidden" id="listAnalyticsKey" value="19"/>
        <input type="hidden" id="listAnalyticsDomain" value="comalatech.matomo.cloud"/>
    </fieldset>
            <div id='stp-licenseStatus-banner'></div>
    <ul id="assistive-skip-links" class="assistive">
    <li><a href="#title-heading">Skip to content</a></li>
    <li><a href="#breadcrumbs">Skip to breadcrumbs</a></li>
    <li><a href="#header-menu-bar">Skip to header menu</a></li>
    <li><a href="#navigation">Skip to action menu</a></li>
    <li><a href="#quick-search-query">Skip to quick search</a></li>
</ul>
<div id="page">
<div id="full-height-container">
    <div id="header-precursor">
        <div class="cell">
            
                            </div>
    </div>
        





<header id="header" role="banner">
    <nav class="aui-header aui-dropdown2-trigger-group" aria-label="Site"><div class="aui-header-inner"><div class="aui-header-before"><button class=" aui-dropdown2-trigger app-switcher-trigger aui-dropdown2-trigger-arrowless" aria-controls="app-switcher" aria-haspopup="true" role="button" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></button><div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" hidden data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}"><div class="app-switcher-loading">Loading&hellip;</div></div></div><div class="aui-header-primary"><span id="logo" class="aui-header-logo aui-header-logo-confluence"><a href="https://cwiki.apache.org/confluence/" aria-label="Go to home page"><span class="aui-header-logo-device">Apache Software Foundation</span></a></span><ul class="aui-nav">
                            <li>
            
        
        
<a  id="space-directory-link" href="https://cwiki.apache.org/confluence/spacedirectory/view.action"  class=" aui-nav-imagelink"   title="Spaces">
            <span>Spaces</span>
    </a>
        </li>
                                <li class="aui-buttons">
            </li>
</ul>
</div><div class="aui-header-secondary"><ul class="aui-nav">
                        <li>
        <div id="search-ui" class="aui-quicksearch dont-default-focus header-quicksearch"><input id="quick-search-query" aria-label="Search" placeholder="Search" type="text" /><div id="quick-search-alert" role="alert">Hit enter to search</div><aui-spinner size="small"></aui-spinner></div>
    </li>
        <li>
            
        <a id="help-menu-link" class="aui-nav-link aui-dropdown2-trigger aui-dropdown2-trigger-arrowless" href="#" aria-haspopup="true" aria-owns="help-menu-link-content" title="Help">
        <span class="aui-icon aui-icon-small aui-iconfont-question-filled">Help</span>
    </a>
    <nav id="help-menu-link-content" class="aui-dropdown2 aui-style-default" aria-hidden="true">
                    <div class="aui-dropdown2-section">
                                <ul  id="help-menu-link-leading" class="aui-list-truncate section-leading first">
                                            <li>
        
            
<a  id="confluence-help-link" href="https://docs.atlassian.com/confluence/docs-713/" class="    "      title="Visit the Confluence documentation home"  target="_blank"
>
        Online Help
</a>
</li>
                                            <li>
    
            
<a  id="keyboard-shortcuts-link" href="https://cwiki.apache.org/confluence" class="    "      title="View available keyboard shortcuts" >
        Keyboard Shortcuts
</a>
</li>
                                            <li>
    
            
<a  id="feed-builder-link" href="https://cwiki.apache.org/confluence/dashboard/configurerssfeed.action" class="    "      title="Create your custom RSS feed." >
        Feed Builder
</a>
</li>
                                            <li>
    
            
<a  id="whats-new-menu-link" href="https://docs.atlassian.com/confluence/docs-713/help.whats.new.iframe.link" class="    "      title="" >
        What’s new
</a>
</li>
                                            <li>
    
            
<a  id="whats-new-menu-link" href="https://confluence.atlassian.com/display/DOC/Confluence+7.13+Release+Notes" class="    "      title="" >
        What’s new
</a>
</li>
                                            <li>
    
            
<a  id="gadget-directory-link" href="https://cwiki.apache.org/confluence" class="   user-item administration-link "      title="Browse gadgets provided by Confluence" >
        Available Gadgets
</a>
</li>
                                            <li>
    
            
<a  id="confluence-about-link" href="https://cwiki.apache.org/confluence/aboutconfluencepage.action" class="    "      title="Get more information about Confluence" >
        About Confluence
</a>
</li>
                                    </ul>
            </div>
            </nav>
    
    </li>
        <li>
                
    
    </li>
        <li>
            
    </li>
        <li>
                                            <li>
        
            
<a  id="login-link" href="https://cwiki.apache.org/confluence/login.action?os_destination=%2Fdisplay%2FHive%2FHive%2BTransactions" class="   user-item login-link "      title="" >
        Log in
</a>
</li>
                        <li>
    
            
<a  id="signup-link" href="https://cwiki.apache.org/confluence/signup.action" class="   user-item signup-link "      title="" >
        Sign up
</a>
</li>
                        
    </li>
    </ul>
</div></div><!-- .aui-header-inner--></nav><!-- .aui-header -->
    <br class="clear">
</header>
    

    
    	<div class="ia-splitter">
    		<div class="ia-splitter-left">
    			<div class="ia-fixed-sidebar">
                                            
                            <div class="acs-side-bar ia-scrollable-section"><div class="acs-side-bar-space-info tipsy-enabled" data-configure-tooltip="Edit space details"><div class="avatar"><div class="space-logo" data-key="Hive" data-name="Apache Hive" data-entity-type="confluence.space"><div class="avatar-img-container"><div class="avatar-img-wrapper"><a href="Home.html" title="Apache Hive"><img class="avatar-img" src="https://cwiki.apache.org/confluence/download/attachments/27362113/Hive?version=2&amp;modificationDate=1317659390000&amp;api=v2" alt="Apache Hive"></a></div></div></div></div><div class="space-information-container"><div class="name"><a href="Home.html" title="Apache Hive">Apache Hive</a></div><div class="flyout-handle icon aui-icon aui-icon-small aui-iconfont-edit"></div></div></div><div class="acs-side-bar-content"><div class="acs-nav-wrapper"><div class="acs-nav" data-has-create-permission="false" data-quick-links-state="null" data-page-tree-state="null" data-nav-type="pages"><div class="acs-nav-sections"><div class="main-links-section "><ul class="acs-nav-list"><li class="acs-nav-item wiki current-item" aria-current="true" data-collector-key="spacebar-pages"><a class="acs-nav-item-link tipsy-enabled" href="https://cwiki.apache.org/confluence/collector/pages.action?key=Hive" data-collapsed-tooltip="Pages"><span class="icon"></span><span class="acs-nav-item-label">Pages</span></a></li><li class="acs-nav-item blog" data-collector-key="spacebar-blogs"><a class="acs-nav-item-link tipsy-enabled" href="https://cwiki.apache.org/confluence/pages/viewrecentblogposts.action?key=Hive" data-collapsed-tooltip="Blog"><span class="icon"></span><span class="acs-nav-item-label">Blog</span></a></li></ul></div><div class="quick-links-wrapper"><h5 class="ia-quick-links-header-title">Space shortcuts</h5><div class="quick-links-section tipsy-enabled "><ul class="acs-nav-list"><li class="acs-nav-item pinned_page blueprint kb-how-to-article"><a class="acs-nav-item-link tipsy-enabled" href="How-to%2barticles.html" data-collapsed-tooltip="null"><span class="icon"></span><span class="acs-nav-item-label">How-to articles</span></a></li></ul></div></div></div></div></div><div class="ia-secondary-container tipsy-enabled" data-tree-type="pages"><div class="ia-secondary-header"><h5 class="ia-secondary-header-title pages"><span class="label">Child pages</span></h5></div><div class="ia-secondary-parent-content"><ul class="parent ia-secondary-header-title wiki"><li class="parent-item"><a class="parent-item-link" href="Home.html" title="Home"><span class="icon"></span><span class="label">Home</span></a></li></ul></div><div class="ia-secondary-current-content"><ul class="ia-secondary-currentPage-title wiki current-item"><li><span class="icon"></span><span class="label">Hive Transactions</span></li></ul></div><div class="ia-secondary-content"><div class="contextual-nav-child-pages"><ul class="children"><li class="child-item" data-page-id="61337025"><span class="icon"></span><a href="HCatalog%2bStreaming%2bMutation%2bAPI.html" title="HCatalog Streaming Mutation API"><span class="label">HCatalog Streaming Mutation API</span></a></li></ul></div></div></div></div><div class="hidden"><a href="https://cwiki.apache.org/confluence/collector/pages.action?key=Hive" id="space-pages-link"></a><script type="text/x-template" title="logo-config-content"><h2>Space Details</h2><div class="personal-space-logo-hint">Your profile picture is used as the logo for your personal space. <a href="/confluence/users/profile/editmyprofilepicture.action" target="_blank">Change your profile picture</a>.</div></script></div></div><div class="space-tools-section"><div id="space-tools-menu-additional-items" class="hidden"><div data-label="Browse pages" data-class="" data-href="/confluence/pages/reorderpages.action?key=Hive">Browse pages</div></div><button id="space-tools-menu-trigger"  class=" aui-dropdown2-trigger aui-button aui-button-subtle tipsy-enabled aui-dropdown2-trigger-arrowless " aria-controls="space-tools-menu" aria-haspopup="true" role="button" data-aui-trigger><span class="aui-icon aui-icon-small aui-iconfont-configure">Configure</span><span class="aui-button-label">Space tools</span><span class="aui-icon "></span></button><div id="space-tools-menu" class="aui-dropdown2 aui-style-default space-tools-dropdown" role="menu" hidden data-aui-alignment="top left"></div><a href="#" role="button" class="expand-collapse-trigger aui-icon aui-icon-small aui-iconfont-chevron-double-left" aria-expanded="true"></a></div>
                    
                        			</div>
    		</div>
        <!-- \#header -->

            
    
        <div id="main" class=" aui-page-panel">
                        <div id="main-header">
                        
    <div id="navigation" class="content-navigation view">
                    <ul class="ajs-menu-bar">
                                            
        <li class="normal ajs-menu-item">
        <a id="action-menu-link" class="action aui-dropdown2-trigger-arrowless aui-button aui-button-subtle ajs-menu-title aui-dropdown2-trigger" href="#" aria-haspopup="true" aria-label="More options" aria-owns="action-menu" data-container="#navigation">
            <span>
                                    <span class="aui-icon aui-icon-small aui-iconfont-more" aria-label="More options"></span>
                                
            </span>
        </a>         <div id="action-menu" class="aui-dropdown2 aui-style-default" aria-hidden="true">
                            <div class="aui-dropdown2-section">
                    <ul  id="action-menu-primary"                         class="section-primary first">
                                                    <li>

    
        
    
                                                        
    
    
            <a  id="view-attachments-link" href="https://cwiki.apache.org/confluence/pages/viewpageattachments.action?pageId=40509723" rel="nofollow" class="action-view-attachments"  accessKey="t"  title="View Attachments" >
                        <span>
                                A<u>t</u>tachments (0)
            </span>        </a>
    </li>
                                                <li>

    
        
    
                                                        
    
    
            <a  id="action-view-history-link" href="https://cwiki.apache.org/confluence/pages/viewpreviousversions.action?pageId=40509723" rel="nofollow" class="action-view-history"   title="" >
                        <span>
                                Page History
            </span>        </a>
    </li>
                                                <li>

    
        
    
                                                        
    
    
            <a  id="who-can-view-button-ak-button" href="https://cwiki.apache.org/confluence" rel="nofollow" class="who-can-view-link"   title="" >
                        <span>
                                People who can view
            </span>        </a>
    </li>
                                        </ul>
                </div>
                            <div class="aui-dropdown2-section">
                    <ul  id="action-menu-secondary"                         class="section-secondary">
                                                    <li>

    
        
    
                                                        
    
    
            <a  id="view-resolved-comments" href="https://cwiki.apache.org/confluence" rel="nofollow" class=""   title="" >
                        <span>
                                Resolved comments
            </span>        </a>
    </li>
                                                <li>

    
        
    
                                                        
    
    
            <a  id="view-page-info-link" href="https://cwiki.apache.org/confluence/pages/viewinfo.action?pageId=40509723" rel="nofollow" class="action-view-info"   title="" >
                        <span>
                                Page Information
            </span>        </a>
    </li>
                                                <li>

    
        
    
                                                        
    
    
            <a  id="view-in-hierarchy-link" href="https://cwiki.apache.org/confluence/pages/reorderpages.action?key=Hive&amp;openId=40509723#selectedPageInHierarchy" rel="nofollow" class=""   title="" >
                        <span>
                                View in Hierarchy
            </span>        </a>
    </li>
                                                <li>

    
        
    
                                                        
    
    
            <a  id="action-view-source-link" href="https://cwiki.apache.org/confluence/plugins/viewsource/viewpagesrc.action?pageId=40509723" rel="nofollow" class="action-view-source popup-link"   title="" >
                        <span>
                                View Source
            </span>        </a>
    </li>
                                                <li>

    
        
    
                                                        
    
    
            <a  id="delete-all-comments-link-link" href="https://cwiki.apache.org/confluence/plugins/aptis/deleteAllComments/ask-user.action?pageId=40509723" rel="nofollow" class=""   title="" >
                        <span>
                                Delete comments
            </span>        </a>
    </li>
                                                <li>

    
        
    
                                                        
    
    
            <a  id="action-export-pdf-link" href="https://cwiki.apache.org/confluence/spaces/flyingpdf/pdfpageexport.action?pageId=40509723" rel="nofollow" class=""   title="" >
                        <span>
                                Export to PDF
            </span>        </a>
    </li>
                                                <li>

    
        
    
                                                        
    
    
            <a  id="com-k15t-confluence-scroll-epub-launcher" href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=40509723" rel="nofollow" class=""   title="" >
                        <span>
                                Export to EPUB
            </span>        </a>
    </li>
                                                <li>

    
        
    
                                                        
    
    
            <a  id="action-export-word-link" href="https://cwiki.apache.org/confluence/exportword?pageId=40509723" rel="nofollow" class="action-export-word"   title="" >
                        <span>
                                Export to Word
            </span>        </a>
    </li>
                                        </ul>
                </div>
                            <div class="aui-dropdown2-section">
                    <ul  id="action-menu-modify"                         class="section-modify">
                                                    <li>

    
        
    
                                                        
    
    
            <a  id="treecopy-action" href="https://cwiki.apache.org/confluence/plugins/tree-copy/preparing-copying.action?pageId=40509723" rel="nofollow" class=""   title="" >
                        <span>
                                Copy Page Tree
            </span>        </a>
    </li>
                                        </ul>
                </div>
                    </div>
    </li>
            </ul>
    </div>

            
            <div id="title-heading" class="pagetitle with-breadcrumbs">
                
                                    <div id="breadcrumb-section">
                        
    
    
    <ol id="breadcrumbs">
                                        
                        
        <li class="first" >
                        
                            <span class=""><a href="https://cwiki.apache.org/confluence/collector/pages.action?key=Hive">Pages</a></span>
                                                                                    
                        
        <li>
                        
                            <span class=""><a href="Home.html">Home</a></span>
                                                                    </ol>


                    </div>
                
                
        <a href="#page-banner-end" class="assistive">Skip to end of banner</a>
<div id="page-banner-start" class="assistive"></div>

                    
            <div id="page-metadata-banner"><ul class="banner"><li id="system-content-items" class="noprint"><a href="#" title="Unrestricted" id="content-metadata-page-restrictions-hidden" class="hidden"></a></li><li class="page-metadata-item noprinthas-button"  id="content-metadata-jira-wrapper"><a href="#" title="" id="content-metadata-jira" class="aui-button aui-button-subtle content-metadata-jira tipsy-disabled hidden"><span>Jira links</span></a></li></ul></div>
            

<a href="#page-banner-start" class="assistive">Go to start of banner</a>
<div id="page-banner-end" class="assistive"></div>
    

                <h1 id="title-text" class="with-breadcrumbs">
                                                <a href="Hive%2bTransactions.html">Hive Transactions</a>
                                    </h1>
            </div>
        </div><!-- \#main-header -->
        
        

        <div id="sidebar-container">
                                                </div><!-- \#sidebar-container -->

        
    

        




            
    

                                
    

    
    
        
    
    
                    
    

    

    
            
        

    
    

    
            
        



    
<div id="content" class="page view">
    


<div id="action-messages">
                        </div>



            <script type="text/x-template" title="searchResultsGrid">
    <table class="aui">
        <thead>
            <tr class="header">
                <th class="search-result-title">Page Title</th>
                <th class="search-result-space">Space</th>
                <th class="search-result-date">Updated</th>
            </tr>
        </thead>
    </table>
</script>
<script type="text/x-template" title="searchResultsGridCount">
    <p class="search-result-count">{0}</p>
</script>
<script type="text/x-template" title="searchResultsGridRow">
    <tr class="search-result">
        <td class="search-result-title"><a href="{1}" class="content-type-{2}"><span>{0}</span></a></td>
        <td class="search-result-space"><a class="space" href="/confluence/display/{4}/" title="{3}">{3}</a></td>
        <td class="search-result-date"><span class="date" title="{6}">{5}</span></td>
    </tr>
</script>
        
    
            

        
                            
    

                    

        
        <a href="#page-metadata-end" class="assistive">Skip to end of metadata</a>
<div id="page-metadata-start" class="assistive"></div>

    <div class="page-metadata">
        <ul>
            <li class="page-metadata-modification-info">
                
        
    
        
    
        
            
            Created by <span class='author'>     <a href="https://cwiki.apache.org/confluence/login.action?os_destination=%2Fusers%2Fviewuserprofile.action%3Fusername%3Dalangates&amp;permissionViolation=true"
                       class="url fn"
                            >Alan Gates</a></span>, last modified by <span class='editor'>     <a href="https://cwiki.apache.org/confluence/login.action?os_destination=%2Fusers%2Fviewuserprofile.action%3Fusername%3Dklcopp&amp;permissionViolation=true"
                       class="url fn"
                            >Karen Coppage</a></span> on <a class='last-modified' title='Show changes' href='https://cwiki.apache.org/confluence/pages/diffpagesbyversion.action?pageId=40509723&amp;selectedPageVersions=93&amp;selectedPageVersions=94'>Aug 10, 2021</a>
                </li>
        </ul>
    </div>


<a href="#page-metadata-start" class="assistive">Go to start of metadata</a>
<div id="page-metadata-end" class="assistive"></div>

        
                                            
        <div id="main-content" class="wiki-content">
                           
        <h1 class="p1" id="HiveTransactions-ACIDandTransactionsinHive"><span style="letter-spacing: 0.0px;">ACID and Transactions in Hive</span></h1><p><div class="toc-macro client-side-toc-macro  conf-macro output-block" data-headerelements="H1,H2,H3,H4,H5,H6,H7" data-hasbody="false" data-macro-name="toc"> </div></p><div class="confluence-information-macro confluence-information-macro-warning conf-macro output-block" data-hasbody="true" data-macro-name="warning"><p class="title">Hive 3 Warning</p><span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"> </span><div class="confluence-information-macro-body"><p>Any transactional tables created by a Hive version prior to Hive 3 require Major Compaction to be run on every partition before upgrading to 3.0.  More precisely, any partition which has had any update/delete/merge statements executed on it since the last Major Compaction, has to undergo another Major Compaction.  No more update/delete/merge may happen on this partition until after Hive is upgraded to Hive 3.</p></div></div><h2 class="p6" id="HiveTransactions-WhatisACIDandwhyshouldyouuseit?">What is ACID and why should you use it?</h2><p class="p6">ACID stands for four traits of database transactions:  Atomicity (an operation either succeeds completely or fails, it does not leave partial data), Consistency (once an application performs an operation the results of that operation are visible to it in every subsequent operation), <a href="https://en.wikipedia.org/wiki/Isolation_(database_systems)" class="external-link" rel="nofollow">Isolation</a> (an incomplete operation by one user does not cause unexpected side effects for other users), and Durability (once an operation is complete it will be preserved even in the face of machine or system failure).  These traits have long been expected of database systems as part of their transaction functionality.  </p><p class="p6">Up until Hive 0.13, atomicity, consistency, and durability were provided at the partition level.  Isolation could be provided by turning on one of the available locking mechanisms (<a href="http://zookeeper.apache.org/" class="external-link" rel="nofollow">ZooKeeper</a> or in memory).  With the addition of transactions in <a href="https://issues.apache.org/jira/browse/HIVE-5317" class="external-link" rel="nofollow">Hive 0.13</a> it is now possible to provide full ACID semantics at the row level, so that one application can add rows while another reads from the same partition without interfering with each other.</p><p class="p6">Transactions with ACID semantics have been added to Hive to address the following use cases:</p><ol class="ol1"><li class="li6">Streaming ingest of data.  Many users have tools such as <a href="http://flume.apache.org/" class="external-link" rel="nofollow">Apache Flume</a>, <a href="https://storm.incubator.apache.org/" class="external-link" rel="nofollow">Apache Storm</a>, or <a href="http://kafka.apache.org/" class="external-link" rel="nofollow">Apache Kafka</a> that they use to stream data into their Hadoop cluster.  While these tools can write data at rates of hundreds or more rows per second, Hive can only add partitions every fifteen minutes to an hour.  Adding partitions more often leads quickly to an overwhelming number of partitions in the table.  These tools could stream data into existing partitions, but this would cause readers to get dirty reads (that is, they would see data written after they had started their queries) and leave many small files in their directories that would put pressure on the NameNode.  With this new functionality this use case will be supported while allowing readers to get a consistent view of the data and avoiding too many files.</li><li class="li6">Slow changing dimensions.  In a typical star schema data warehouse, dimensions<span class="s5"> </span>tables change slowly over time.  For example, a retailer will open new stores, which need to be added to the stores table, or an existing store may change its square footage or some other tracked characteristic.  These changes lead to inserts of individual records or updates<span class="s5"> </span>of records (depending on the strategy chosen).  Starting with 0.14, Hive is able to support this.</li><li class="li6">Data restatement.  Sometimes collected data is found to be incorrect and needs correction.  Or the first instance of the data may be an approximation (90% of servers reporting) with the full data provided later.  Or business rules may require that certain transactions be restated due to subsequent transactions (e.g., after making a purchase a customer may purchase a membership and thus be entitled to discount prices, including on the previous purchase).  Or a user may be contractually required to remove their customer’s data upon termination of their relationship.  Starting with Hive 0.14 these use cases can be supported via <em><a href="LanguageManual%2bDML.html" rel="nofollow">INSERT</a>, <a href="LanguageManual%2bDML.html#LanguageManualDML-Update" rel="nofollow">UPDATE</a></em>, and <em><a href="LanguageManual%2bDML.html#LanguageManualDML-Delete" rel="nofollow">DELETE</a></em>.</li><li class="li6">Bulk updates using <a href="LanguageManual%2bDML.html#LanguageManualDML-Merge" rel="nofollow">SQL MERGE</a> statement.</li></ol><h2 class="p6" id="HiveTransactions-Limitations">Limitations</h2><ul><li class="p6"><em>BEGIN</em>, <em>COMMIT</em>, and <em>ROLLBACK</em> are not yet supported.  All language operations are auto-commit.  The plan is to support these in a future release.</li><li class="p6">Only <a href="LanguageManual%2bORC.html">ORC file format</a> is supported in this first release.  The feature has been built such that transactions can be used by any storage format that can determine how updates or deletes apply to base records (basically, that has an explicit or implicit row id), but so far the integration work has only been done for ORC.</li><li class="p6">By default transactions are configured to be off.  See the <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=82706483#HiveTransactions-Configuration">Hive Transactions#Configuration</a> section below for a discussion of which values need to be set to configure it.</li><li class="p6">Tables must be <a href="LanguageManual%2bDDL%2bBucketedTables.html">bucketed</a> to make use of these features.  Tables in the same system not using transactions and ACID do not need to be bucketed. External tables cannot be made ACID tables since the changes on external tables are beyond the control of the compactor (<a href="https://issues.apache.org/jira/browse/HIVE-13175" class="external-link" rel="nofollow">HIVE-13175</a>).</li><li class="p6">Reading/writing to an ACID table from a non-ACID session is not allowed. In other words, the Hive transaction manager must be set to org.apache.hadoop.hive.ql.lockmgr.DbTxnManager in order to work with ACID tables.</li><li class="p6">At this time only snapshot level isolation is supported.  When a given query starts it will be provided with a consistent snapshot of the data.  There is no support for dirty read, read committed, repeatable read, or serializable.  With the introduction of BEGIN the intention is to support<span class="s5"> </span>snapshot isolation for the duration of transaction rather than just a single query.  Other isolation levels may be added depending on user requests.</li><li class="p6">The existing ZooKeeper and in-memory lock managers are not compatible with transactions.  There is no intention to address this issue.  See <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=82706483#HiveTransactions-BasicDesign">Hive Transactions#Basic Design</a> below for a discussion of how locks are stored for transactions.</li><li class="p6"><s>Schema changes using ALTER TABLE is NOT supported for ACID tables. <a href="https://issues.apache.org/jira/browse/HIVE-11421" class="external-link" rel="nofollow">HIVE-11421</a> is tracking it.</s>  Fixed in 1.3.0/2.0.0.</li><li class="p6">Using Oracle as the Metastore DB and &quot;datanucleus.connectionPoolingType=BONECP&quot; may generate intermittent &quot;No such lock..&quot; and &quot;No such transaction...&quot; errors.  Setting &quot;datanucleus.connectionPoolingType=DBCP&quot; is recommended in this case. </li><li class="p6"><a href="LanguageManual%2bDML.html#LanguageManualDML-Loadingfilesintotables" rel="nofollow">LOAD DATA...</a> statement is not supported with transactional tables.  (This was not properly enforced until <a href="https://issues.apache.org/jira/browse/HIVE-16732" class="external-link" rel="nofollow">HIVE-16732</a>)</li></ul><h2 class="p6" id="HiveTransactions-StreamingAPIs">Streaming APIs</h2><p>Hive offers APIs for streaming data ingest and streaming mutation:</p><ul><li><a href="Streaming%2bData%2bIngest.html">Hive HCatalog Streaming API</a></li><li><a href="Streaming%2bData%2bIngest%2bV2.html" rel="nofollow">Hive Streaming API</a> (Since Hive 3)</li><li><a href="HCatalog%2bStreaming%2bMutation%2bAPI.html">HCatalog Streaming Mutation API</a> (available in Hive 2.0.0 and later)</li></ul><p>A comparison of these two APIs is available in the <a href="HCatalog%2bStreaming%2bMutation%2bAPI.html#HCatalogStreamingMutationAPI-Background">Background</a> section of the Streaming Mutation document.</p><h2 class="p6" id="HiveTransactions-GrammarChanges"><span style="line-height: 1.5;">Grammar Changes</span></h2><p class="p6"><em>INSERT...VALUES, UPDATE</em>, and <em>DELETE</em> have been added to the SQL grammar, starting in <a href="https://issues.apache.org/jira/browse/HIVE-5317" class="external-link" rel="nofollow">Hive 0.14</a>.  See <a href="LanguageManual%2bDML.html">LanguageManual DML</a> for details.</p><p class="p6">Several new commands have been added to Hive's DDL in support of ACID and transactions, plus some existing DDL has been modified.  </p><p class="p6">A new command <em>SHOW TRANSACTIONS</em> has been added, see <a href="LanguageManual%2bDDL.html#LanguageManualDDL-ShowTransactions">Show Transactions</a> for details.</p><p class="p6">A new command <em>SHOW COMPACTIONS</em> has been added, see <a href="LanguageManual%2bDDL.html#LanguageManualDDL-ShowCompactions">Show Compactions</a> for details.</p><p class="p6">The <em>SHOW LOCKS</em> command has been altered to provide information about the new locks associated with transactions.  If you are using the ZooKeeper or in-memory lock managers you will notice no difference in the output of this command.  See <a href="LanguageManual%2bDDL.html#LanguageManualDDL-ShowLocks">Show Locks</a> for details.</p><p class="p6">A new option has been added to <em>ALTER TABLE</em> to request a compaction of a table or partition.  In general users do not need to request compactions, as the system will detect the need for them and initiate the compaction.  However, if <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=82706483#HiveTransactions-TableProperties">compaction is turned off</a> for a table or a user wants to compact the table at a time the system would not choose to, <em>ALTER TABLE</em> can be used to initiate the compaction.  See <a href="LanguageManual%2bDDL.html#LanguageManualDDL-AlterTable/PartitionCompact">Alter Table/Partition Compact</a> for details.<span style="font-size: 14.0px;line-height: 1.4285715;">  This will enqueue a request for compaction and return.  To watch the progress of the compaction the user can use </span><em style="font-size: 14.0px;line-height: 1.4285715;">SHOW COMPACTIONS</em><span style="font-size: 14.0px;line-height: 1.4285715;">.</span></p><p class="p6"><span style="font-size: 14.0px;line-height: 1.4285715;">A new command <em>ABORT TRANSACTIONS</em> has been added, see <a href="LanguageManual%2bDDL.html#LanguageManualDDL-AbortTransactions" rel="nofollow">Abort Transactions</a> for details.</span></p><h2 class="p6" id="HiveTransactions-BasicDesign">Basic Design</h2><p class="p6">HDFS does not support in-place changes to files.  It also does not offer read consistency in the face of writers appending to files being read by a user.  In order to provide these features on top of HDFS we have followed the standard approach used in other data warehousing tools.  Data for the table or partition is stored in a set of base files.  New records, updates, and deletes are stored in delta files.  A new set of delta files is created for each transaction (or in the case of streaming agents such as Flume or Storm, each batch of transactions) that alters a table or partition.  At read time the reader merges the base and delta files, applying any updates and deletes as it reads.</p><h3 class="p6" id="HiveTransactions-BaseandDeltaDirectories">Base and Delta Directories</h3><p class="p6">Previously all files for a partition (or a table if the table is not partitioned) lived in a single directory.  With these changes, any partitions (or tables) written with an ACID aware writer will have a directory for the base files and a directory for each set of delta files.  Here is what this may look like for an unpartitioned table &quot;t&quot;:</p><div class="code panel pdl conf-macro output-block" style="border-width: 1px;" data-hasbody="true" data-macro-name="code"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Filesystem Layout for Table &quot;t&quot;</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Default" data-theme="Default">hive&gt; dfs -ls -R /user/hive/warehouse/t;
drwxr-xr-x   - ekoifman staff          0 2016-06-09 17:03 /user/hive/warehouse/t/base_0000022
-rw-r--r--   1 ekoifman staff        602 2016-06-09 17:03 /user/hive/warehouse/t/base_0000022/bucket_00000
drwxr-xr-x   - ekoifman staff          0 2016-06-09 17:06 /user/hive/warehouse/t/delta_0000023_0000023_0000
-rw-r--r--   1 ekoifman staff        611 2016-06-09 17:06 /user/hive/warehouse/t/delta_0000023_0000023_0000/bucket_00000
drwxr-xr-x   - ekoifman staff          0 2016-06-09 17:07 /user/hive/warehouse/t/delta_0000024_0000024_0000
-rw-r--r--   1 ekoifman staff        610 2016-06-09 17:07 /user/hive/warehouse/t/delta_0000024_0000024_0000/bucket_00000</pre>
</div></div><h3 class="p6" id="HiveTransactions-Compactor">Compactor</h3><p>Compactor is a set of background processes running inside the Metastore to support ACID system.  It consists of Initiator, Worker, Cleaner, AcidHouseKeeperService and a few others.</p><h4 class="p6" id="HiveTransactions-DeltaFileCompaction">Delta File Compaction</h4><p class="p6">As operations modify the table more and more delta files are created and need to be compacted to maintain adequate performance.  There are two types of compactions, minor and major.</p><ul><li class="p6">Minor compaction takes a set of existing delta files and rewrites them to a single delta file per bucket.</li><li class="p6">Major compaction takes one or more delta files and the base file for the bucket and rewrites them into a new base file per bucket.  Major compaction is more expensive but is more effective.</li></ul><p class="p6">All compactions are done in the background and do not prevent concurrent reads and writes of the data.  After a compaction the system waits until all readers of the old files have finished and then removes the old files.</p><h4 class="p6" id="HiveTransactions-Initiator">Initiator</h4><p class="p6">This module is responsible for discovering which tables or partitions are due for compaction.  This should be enabled in a Metastore using <a href="Configuration%2bProperties.html#ConfigurationProperties-hive.compactor.initiator.on">hive.compactor.initiator.on</a>.  There are several properties of the form *.threshold in &quot;New Configuration Parameters for Transactions<span style="line-height: 1.42857;">&quot; table below that control when a compaction task is created and which type of compaction is performed.  Each compaction task handles 1 partition (or whole table if the table is unpartitioned).  If the number of consecutive compaction failures for a given partition exceeds <span style="color: rgb(0,0,0);">hive.compactor.initiator.failed.compacts.threshold, automatic compaction scheduling will stop for this partition.  See Configuration Parameters table for more info.</span></span></p><h4 class="p6" id="HiveTransactions-Worker"><span style="line-height: 1.42857;">Worker</span></h4><p class="p6"><span style="line-height: 20.0px;">Each Worker handles a single compaction task.  A compaction is a</span> MapReduce job with name in the following form: &lt;hostname&gt;-compactor-&lt;db&gt;.&lt;table&gt;.&lt;partition&gt;.  Each worker submits the job to the cluster (via <a href="Configuration%2bProperties.html#ConfigurationProperties-hive.compactor.job.queue">hive.compactor.job.queue</a> if defined) and waits for the job to finish.  <a href="Configuration%2bProperties.html#ConfigurationProperties-hive.compactor.worker.threads">hive.compactor.worker.threads</a> determines the number of Workers in each Metastore.  The total number of Workers in the Hive Warehouse determines the maximum number of concurrent compactions.</p><h4 class="p6" id="HiveTransactions-Cleaner">Cleaner</h4><p>This process is a process that deletes delta files after compaction and after it determines that they are no longer needed.</p><h4 id="HiveTransactions-AcidHouseKeeperService">AcidHouseKeeperService</h4><p>This process looks for transactions that have not heartbeated in <a href="Configuration%2bProperties.html#ConfigurationProperties-hive.txn.timeout">hive.txn.timeout</a><span> time and aborts them.  The system assumes that a client that initiated a transaction stopped heartbeating crashed and the resources it locked should be released.</span></p><h4 id="HiveTransactions-SHOWCOMPACTIONS"><span>SHOW COMPACTIONS</span></h4><p>This commands displays information about currently running compaction and recent history (configurable retention period) of compactions.  This history display is available since <a href="https://issues.apache.org/jira/browse/HIVE-12353" class="external-link" rel="nofollow">HIVE-12353</a>.</p><p>Also see <a href="LanguageManual%2bDDL.html#LanguageManualDDL-ShowCompactions">LanguageManual DDL#ShowCompactions</a> for more information on the output of this command and <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=82706483#HiveTransactions-NewConfigurationParametersforTransactions">Hive Transactions#NewConfigurationParametersforTransactions</a>/Compaction History for configuration properties affecting the output of this command.  The system retains the last N entries of each type: failed, succeeded, attempted (where N is configurable for each type).</p><p><br/></p><h3 class="p6" id="HiveTransactions-Transaction/LockManager">Transaction/Lock Manager</h3><p class="p6">A new logical entity called &quot;transaction manager&quot;  was added which incorporated previous notion of &quot;database/table/partition lock manager&quot; (hive.lock.manager with default of org.apache.hadoop.hive.ql.lockmgr.zookeeper.ZooKeeperHiveLockManager). The transaction manager is now additionally responsible for managing of transactions locks. The default DummyTxnManager emulates behavior of old Hive versions: has no transactions and uses hive.lock.manager property to create lock manager for tables, partitions and databases. A newly added DbTxnManager manages all locks/transactions in Hive metastore with DbLockManager (transactions and locks are durable in the face of server failure). This means that previous behavior of locking in ZooKeeper is not present anymore when transactions are enabled. To avoid clients dying and leaving transaction or locks dangling, a heartbeat is sent from lock holders and transaction initiators to the metastore on a regular basis.  If a heartbeat is not received in the configured amount of time, the lock or transaction will be aborted.</p><p class="p6">As of <a href="https://issues.apache.org/jira/browse/HIVE-12529" class="external-link" rel="nofollow">Hive 1.3.0</a>, the length of time that the DbLockManger will continue to try to acquire locks can be controlled via <a href="http://configuration properties/#hive.lock.numretires" class="external-link" rel="nofollow">hive.lock.numretires</a> and <a href="http://configuration properties/#hive.lock.sleep.between.retries" class="external-link" rel="nofollow">hive.lock.sleep.between.retries</a>.  When the DbLockManager cannot acquire a lock (due to existence of a competing lock), it will back off and try again after a certain time period.  In order to support short running queries and not overwhelm the metastore at the same time, the DbLockManager will double the wait time after each retry.  The initial back off time is 100ms and is capped by hive.lock.sleep.between.retries.  hive.lock.numretries is the total number of times it will retry a given lock request.  Thus the total time that the call to acquire locks will block (given values of 100 retries and 60s sleep time) is (100ms + 200ms + 400ms + ... + 51200ms + 60s + 60s + ... + 60s) = 91m:42s:300ms.</p><p class="p6">More <a href="LanguageManual%2bDDL.html#LanguageManualDDL-ShowLocks" rel="nofollow">details</a> on locks used by this Lock Manager.</p><p class="p6">Note that the lock manager used by DbTxnManager will acquire locks on all tables, even those without &quot;transactional=true&quot; property.  By default, Insert operation into a non-transactional table will acquire an exclusive lock and thus block other inserts and reads.  While technically correct, this is a departure from how Hive traditionally worked (i.e. w/o a lock manger).  For backwards compatibility, <a href="http://configuration properties/#hive.txn.strict.locking.mode" class="external-link" rel="nofollow">hive.txn.strict.locking.mode</a> (see table below) is provided which will make this lock manager acquire shared locks on insert operations on non-transactional tables.  This restores previous semantics while still providing the benefit of a lock manager such as preventing table drop while it is being read.  Note that for transactional tables, insert always acquires share locks since these tables implement MVCC architecture at the storage layer and are able to provide strong read consistency (Snapshot Isolation) even in presence of concurrent modification operations.</p><h2 class="p6" id="HiveTransactions-Configuration">Configuration</h2><p class="p6">Minimally, these configuration parameters must be set appropriately to turn on transaction support in Hive:</p><p class="p6">Client Side</p><ul><li class="p6"><span><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.support.concurrency">hive.support.concurrency</a> – true</span></li><li class="p6"><span><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.enforce.bucketing">hive.enforce.bucketing</a> – true (Not required as of <a href="https://issues.apache.org/jira/browse/HIVE-12331" class="external-link" rel="nofollow">Hive 2.0</a>)</span></li><li class="p6"><span><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.exec.dynamic.partition.mode">hive.exec.dynamic.partition.mode</a> – nonstrict</span></li><li class="p6"><span><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.txn.manager">hive.txn.manager</a> – <span>org.apache.hadoop.hive.ql.lockmgr.DbTxnManager</span></span></li></ul><p class="p6"><span><span>Server Side (Metastore)</span></span></p><ul><li class="p6"><span><span><span><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.compactor.initiator.on">hive.compactor.initiator.on</a> – <span>true (See table below for more details)</span></span></span></span></li><li class="p6"><span><span><span><span><span><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.compactor.worker.threads">hive.compactor.worker.threads</a> – a positive number<span> on at least one instance of the Thrift metastore service</span></span></span></span></span></span></li></ul><p class="p6">The following sections list all of the configuration parameters that affect Hive transactions and compaction.  Also see <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=82706483#HiveTransactions-Limitations">Hive Transactions#Limitations</a> above and <a href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=82706483#HiveTransactions-TableProperties">Hive Transactions#Table Properties</a> below.</p><h3 class="p6" id="HiveTransactions-NewConfigurationParametersforTransactions">New Configuration Parameters for Transactions</h3><p class="p6">A number of new configuration parameters have been added to the system to support transactions.</p><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col/><col/><col/><col/></colgroup><tbody><tr><td class="confluenceTd"><p class="p6"><strong>Configuration key</strong></p></td><td class="confluenceTd"><p class="p6"><strong>Values</strong></p></td><td colspan="1" class="confluenceTd"><strong>Location</strong></td><td class="confluenceTd"><p class="p6"><strong>Notes</strong></p></td></tr><tr><td class="confluenceTd"><p class="p6"><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.txn.manager">hive.txn.manager</a> </p></td><td class="confluenceTd"><p class="p6"><em>Default:</em> org.apache.hadoop.hive.ql.lockmgr.DummyTxnManager</p><p class="p6"><em>Value required for transactions:</em> <span>org.apache.hadoop.hive.ql.lockmgr.DbTxnManager</span></p></td><td colspan="1" class="confluenceTd"><p>Client/<br/><span style="font-size: 14.0px;line-height: 1.4285715;">HiveServer2</span></p></td><td class="confluenceTd"><p class="p6">DummyTxnManager replicates pre Hive-0.13 behavior and provides no transactions.</p></td></tr><tr><td colspan="1" class="confluenceTd"><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.txn.strict.locking.mode">hive.txn.strict.locking.mode</a></td><td colspan="1" class="confluenceTd"><em>Default: </em>true</td><td colspan="1" class="confluenceTd"><p>Client/ HiveServer2</p></td><td colspan="1" class="confluenceTd">In strict mode non-ACID resources use standard R/W lock semantics, e.g. INSERT will acquire exclusive lock. In non-strict mode, for non-ACID resources, INSERT will only acquire shared lock, which allows two concurrent writes to the same partition but still lets lock manager prevent DROP TABLE etc. when the table is being written to (as of <a href="https://issues.apache.org/jira/browse/HIVE-15774" class="external-link" rel="nofollow">Hive 2.2.0</a>).</td></tr><tr><td class="confluenceTd"><p class="p6"><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.txn.timeout">hive.txn.timeout</a> </p></td><td class="confluenceTd"><p class="p6"><em>Default: </em>300</p></td><td colspan="1" class="confluenceTd"><p>Client/<br/>HiveServer2/</p><p>Metastore </p></td><td class="confluenceTd"><p class="p6">Time after which transactions are declared aborted if the client has not sent a heartbeat, in seconds. It's critical that this property has the same value for all components/services.<sup>5</sup></p></td></tr><tr><td colspan="1" class="confluenceTd"><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.txn.heartbeat.threadpool.size" rel="nofollow">hive.txn.heartbeat.threadpool.size</a></td><td colspan="1" class="confluenceTd"><em>Default:</em> 5</td><td colspan="1" class="confluenceTd"><p>Client/</p><p>HiveServer2</p></td><td colspan="1" class="confluenceTd">The number of threads to use for heartbeating (as of <a href="https://issues.apache.org/jira/browse/HIVE-12366" class="external-link" rel="nofollow">Hive 1.3.0 and 2.0.0</a>).</td></tr><tr><td colspan="1" class="confluenceTd"><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.timedout.txn.reaper.start">hive.timedout.txn.reaper.start</a></td><td colspan="1" class="confluenceTd"><em>Default:</em> <span>100s</span></td><td colspan="1" class="confluenceTd">Metastore</td><td colspan="1" class="confluenceTd">Time delay of first reaper (the process which aborts timed-out transactions) run after the metastore starts (as of <a href="https://issues.apache.org/jira/browse/HIVE-11317" class="external-link" rel="nofollow">Hive 1.3.0</a>). Controls AcidHouseKeeperServcie above.</td></tr><tr><td colspan="1" class="confluenceTd"><p><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.timedout.txn.reaper.interval">hive.timedout.txn.reaper.interval</a></p></td><td colspan="1" class="confluenceTd"><em>Default:</em> <span style="line-height: 1.4285715;">180s</span></td><td colspan="1" class="confluenceTd">Metastore</td><td colspan="1" class="confluenceTd"><p>Time interval describing how often the reaper (the process which aborts timed-out transactions) runs (as of <a href="https://issues.apache.org/jira/browse/HIVE-11317" class="external-link" rel="nofollow">Hive 1.3.0</a>). <span>Controls AcidHouseKeeperServcie above.</span></p></td></tr><tr><td class="confluenceTd"><p class="p6"><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.txn.max.open.batch">hive.txn.max.open.batch</a></p></td><td class="confluenceTd"><p class="p6"><em>Default: </em>1000</p></td><td colspan="1" class="confluenceTd">Client</td><td class="confluenceTd"><p class="p6">Maximum number of transactions that can be fetched in one call to open_txns().<sup>1</sup></p></td></tr><tr><td colspan="1" class="confluenceTd"><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.max.open.txns">hive.max.open.txns</a></td><td colspan="1" class="confluenceTd"><em>Default:</em> 100000</td><td colspan="1" class="confluenceTd"><p><span>HiveServer2/</span></p><p><span> </span>Metastore</p></td><td colspan="1" class="confluenceTd">Maximum number of open transactions. If current open transactions reach this limit, future open transaction requests will be rejected, until the number goes below the limit. (As of <a href="https://issues.apache.org/jira/browse/HIVE-13249" class="external-link" rel="nofollow">Hive 1.3.0 and 2.1.0</a>.)</td></tr><tr><td colspan="1" class="confluenceTd"><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.count.open.txns.interval">hive.count.open.txns.interval</a></td><td colspan="1" class="confluenceTd"><em>Default:</em> 1s</td><td colspan="1" class="confluenceTd"><p><span>HiveServer2/</span></p><p><span> </span>Metastore</p></td><td colspan="1" class="confluenceTd">Time in seconds between checks to count open transactions<span> (as of </span><a href="https://issues.apache.org/jira/browse/HIVE-13249" class="external-link" rel="nofollow">Hive 1.3.0 and 2.1.0</a><span>).</span></td></tr><tr><td colspan="1" class="confluenceTd"><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.txn.retryable.sqlex.regex">hive.txn.retryable.sqlex.regex</a></td><td colspan="1" class="confluenceTd"><em>Default:</em> &quot;&quot; (empty string)</td><td colspan="1" class="confluenceTd"><p><span>HiveServer2/</span></p><p><span> </span>Metastore</p></td><td colspan="1" class="confluenceTd"><p>Comma separated list of regular expression patterns for SQL state, error code, and error message of retryable SQLExceptions, that's suitable for the Hive metastore database (as of <a href="https://issues.apache.org/jira/browse/HIVE-12637" class="external-link" rel="nofollow">Hive 1.3.0 and 2.1.0</a>).</p><p>For an example, see <a href="Configuration%2bProperties.html#ConfigurationProperties-hive.txn.retryable.sqlex.regex">Configuration Properties</a>.</p></td></tr><tr><td class="confluenceTd"><p class="p6"><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.compactor.initiator.on">hive.compactor.initiator.on</a></p></td><td class="confluenceTd"><p class="p6"><em>Default: </em>false</p><p class="p6"><span><em>Value required for transactions:</em> <span>true (for exactly one instance of the Thrift metastore service)</span></span></p></td><td colspan="1" class="confluenceTd">Metastore</td><td class="confluenceTd"><p class="p6">Whether to run the initiator and cleaner threads on this metastore instance.<u> <span style="color: rgb(0,51,102);">Prior to <a href="https://issues.apache.org/jira/browse/HIVE-11388" class="external-link" rel="nofollow"><span style="color: rgb(0,51,102);">Hive 1.3.0</span></a> i</span><span style="color: rgb(0,51,102);">t</span>'s critical that this is enabled on exactly one standalone metastore service instance (not enforced yet)</u>.</p><p class="p6">As of <a href="https://issues.apache.org/jira/browse/HIVE-11388" class="external-link" rel="nofollow">Hive 1.3.0</a> this property may be enabled on any number of standalone metastore instances.</p><p class="p7"><br/></p></td></tr><tr><td class="confluenceTd"><p class="p6"><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.compactor.worker.threads">hive.compactor.worker.threads</a></p></td><td class="confluenceTd"><p class="p6"><em>Default: </em>0</p><p class="p6"><span><em>Value required for transactions:</em> <span>&gt; 0 on at least one instance of the Thrift metastore service</span></span></p></td><td colspan="1" class="confluenceTd">Metastore</td><td class="confluenceTd"><p class="p6">How many compactor worker threads to run on this metastore instance.<sup>2</sup></p></td></tr><tr><td class="confluenceTd"><p class="p6"><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.compactor.worker.timeout">hive.compactor.worker.timeout</a></p></td><td class="confluenceTd"><p class="p6"><em>Default: </em>86400</p></td><td colspan="1" class="confluenceTd">Metastore</td><td class="confluenceTd"><p class="p6">Time in seconds after which a compaction job will be declared failed and the compaction re-queued.</p></td></tr><tr><td colspan="1" class="confluenceTd"><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.compactor.cleaner.run.interval">hive.compactor.cleaner.run.interval</a></td><td colspan="1" class="confluenceTd"><em>Default</em>: 5000</td><td colspan="1" class="confluenceTd">Metastore</td><td colspan="1" class="confluenceTd">Time in milliseconds between runs of the cleaner thread. (<a href="https://issues.apache.org/jira/browse/HIVE-8258" class="external-link" rel="nofollow">Hive 0.14.0</a> and later.)</td></tr><tr><td class="confluenceTd"><p class="p6"><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.compactor.check.interval">hive.compactor.check.interval</a></p></td><td class="confluenceTd"><p class="p6"><em>Default: </em>300</p></td><td colspan="1" class="confluenceTd">Metastore</td><td class="confluenceTd"><p class="p6">Time in seconds between checks to see if any tables or partitions need to be compacted.<sup>3</sup></p></td></tr><tr><td class="confluenceTd"><p class="p6"><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.compactor.delta.num.threshold">hive.compactor.delta.num.threshold</a></p></td><td class="confluenceTd"><p class="p6"><em>Default: </em>10</p></td><td colspan="1" class="confluenceTd">Metastore</td><td class="confluenceTd"><p class="p6">Number of delta directories in a table or partition that will trigger a minor compaction.</p></td></tr><tr><td class="confluenceTd"><p class="p6"><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.compactor.delta.pct.threshold">hive.compactor.delta.pct.threshold</a></p></td><td class="confluenceTd"><p class="p6"><em>Default: </em>0.1</p></td><td colspan="1" class="confluenceTd">Metastore</td><td class="confluenceTd"><p class="p6">Percentage (fractional) size of the delta files relative to the base that will trigger a major compaction. 1 = 100%, so the default 0.1 = 10%.</p></td></tr><tr><td class="confluenceTd"><p class="p6"><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.compactor.abortedtxn.threshold">hive.compactor.abortedtxn.threshold</a></p></td><td class="confluenceTd"><p class="p6"><em>Default: </em>1000</p></td><td colspan="1" class="confluenceTd">Metastore</td><td class="confluenceTd"><p class="p6">Number of aborted transactions involving a given table or partition that will trigger a major compaction.</p></td></tr><tr><td colspan="1" class="confluenceTd"><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.compactor.aborted.txn.time.threshold">hive.compactor.aborted.txn.time.threshold</a></td><td colspan="1" class="confluenceTd"><em>Default</em>: 12h</td><td colspan="1" class="confluenceTd">Metastore</td><td colspan="1" class="confluenceTd"><span style="color: rgb(60,64,67);">Age of table/partition's oldest aborted transaction when compaction will be triggered. Default time unit is: hours. Set to a negative number to disable.</span></td></tr><tr><td colspan="1" class="confluenceTd"><p><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.compactor.max.num.delta">hive.compactor.max.num.delta</a></p></td><td colspan="1" class="confluenceTd">Default: 500</td><td colspan="1" class="confluenceTd"><span>Metastore</span></td><td colspan="1" class="confluenceTd">Maximum number of delta files that the compactor will attempt to handle in a single job <span>(as of </span><a href="https://issues.apache.org/jira/browse/HIVE-11540" class="external-link" rel="nofollow">Hive 1.3.0</a><span>)</span>.<sup>4</sup></td></tr><tr><td colspan="1" class="confluenceTd"><p><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.compactor.job.queue">hive.compactor.job.queue</a></p></td><td colspan="1" class="confluenceTd"><em>Default</em>: &quot;&quot; (empty string)</td><td colspan="1" class="confluenceTd"> Metastore</td><td colspan="1" class="confluenceTd"> Used to specify name of Hadoop queue to which Compaction jobs will be submitted. Set to empty string to let Hadoop choose the queue <span>(as of </span><a href="https://issues.apache.org/jira/browse/HIVE-11997" class="external-link" rel="nofollow">Hive 1.3.0</a><span>).</span></td></tr><tr><td colspan="4" class="confluenceTd"><u>Compaction History</u></td></tr><tr><td colspan="1" class="confluenceTd"><p><span style="color: rgb(0,0,0);">hive.compactor.history.retention.succeeded</span></p></td><td colspan="1" class="confluenceTd"><em>Default: 3</em></td><td colspan="1" class="confluenceTd"><span>Metastore</span></td><td colspan="1" class="confluenceTd">Number of successful compaction entries to retain in history (per partition).</td></tr><tr><td colspan="1" class="confluenceTd"><p><span style="color: rgb(0,0,0);">hive.compactor.history.retention.failed</span></p></td><td colspan="1" class="confluenceTd"><em>Default: 3</em></td><td colspan="1" class="confluenceTd"><span>Metastore</span></td><td colspan="1" class="confluenceTd"><span>Number of failed compaction <span>entries</span> to retain in history (per partition).</span></td></tr><tr><td colspan="1" class="confluenceTd"><p><span style="color: rgb(0,0,0);">hive.compactor.history.retention.attempted</span></p></td><td colspan="1" class="confluenceTd"><em>Default: 2</em></td><td colspan="1" class="confluenceTd"><span>Metastore</span></td><td colspan="1" class="confluenceTd"><span>Number of attempted compaction entries to retain in history (per partition).</span></td></tr><tr><td colspan="1" class="confluenceTd"><p><span style="color: rgb(0,0,0);">hive.compactor.initiator.failed.compacts.threshold</span></p></td><td colspan="1" class="confluenceTd"><em>Default: 2</em></td><td colspan="1" class="confluenceTd"><span>Metastore</span></td><td colspan="1" class="confluenceTd">Number of of consecutive failed compactions for a given partition after which the Initiator will stop attempting to schedule compactions automatically. It is still possible to use <a href="LanguageManual%2bDDL.html#LanguageManualDDL-AlterTable/PartitionCompact" rel="nofollow">ALTER TABLE</a> to initiate compaction. Once a manually initiated compaction succeeds auto initiated compactions will resume. Note that this must be less than <span style="color: rgb(0,0,0);">hive.compactor.history.retention.failed.</span></td></tr><tr><td colspan="1" class="confluenceTd"><p><span style="color: rgb(0,0,0);">hive.compactor.history.reaper.interval</span></p></td><td colspan="1" class="confluenceTd"><em>Default: 2m</em></td><td colspan="1" class="confluenceTd"><span>Metastore</span></td><td colspan="1" class="confluenceTd">Controls how often the process to purge historical record of compactions runs.</td></tr></tbody></table></div><p class="p6"><span><span><sup>1</sup>hive.txn.max.open.batch</span> controls how many transactions streaming agents such as Flume or Storm open simultaneously.  The streaming agent then writes that number of entries into a single file (per Flume agent or Storm bolt).  Thus increasing this value decreases the number of delta files created by streaming agents.  But it also increases the number of open transactions that Hive has to track at any given time, which may negatively affect read performance.</span></p><p class="p6"><span> </span><sup>2</sup><span>Worker threads spawn MapReduce jobs to do compactions.  They do not do the compactions themselves.  Increasing the number of worker threads will decrease the time it takes tables or partitions to be compacted once they are determined to need compaction.  It will also increase the background load on the Hadoop cluster as more MapReduce jobs will be running in the background.  Each compaction can handle one partition at a time (or whole table if it's unpartitioned).  </span></p><p class="p6"><sup>3</sup><span>Decreasing this value will reduce the time it takes for compaction to be started for a table or partition that requires compaction.  However, checking if compaction is needed requires several calls to the NameNode for each table or partition that has had a transaction done on it since the last major compaction.  So decreasing this value will increase the load on the NameNode.</span></p><p class="p6"><span><sup>4</sup>If the compactor detects a very high number of delta files, it will first run several partial minor compactions (currently sequentially) and then perform the compaction actually requested.</span></p><p class="p6"><span><sup>5</sup>If the value is not the same active transactions may be determined to be &quot;timed out&quot; and consequently Aborted.  This will result in errors like &quot;No such transaction...&quot;, &quot;No such lock ...&quot;</span></p><h3 class="p6" id="HiveTransactions-ConfigurationValuestoSetforINSERT,UPDATE,DELETE">Configuration Values to Set for <em>INSERT, UPDATE, DELETE</em></h3><p>In addition to the new parameters listed above, some existing parameters need to be set to support <em>INSERT ... VALUES, UPDATE, </em>and <em>DELETE</em>.</p><div class="table-wrap"><table class="wrapped confluenceTable"><tbody><tr><th class="confluenceTh">Configuration key</th><th class="confluenceTh">Must be set to</th></tr><tr><td colspan="1" class="confluenceTd"><span><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.support.concurrency">hive.support.concurrency</a></span></td><td colspan="1" class="confluenceTd">true (default is false)</td></tr><tr><td class="confluenceTd"><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.enforce.bucketing">hive.enforce.bucketing</a></td><td class="confluenceTd">true (default is false) (Not required as of <a href="https://issues.apache.org/jira/browse/HIVE-12331" class="external-link" rel="nofollow">Hive 2.0</a>)</td></tr><tr><td colspan="1" class="confluenceTd"><a href="Configuration%2bProperties.html#ConfigurationProperties-hive.exec.dynamic.partition.mode">hive.exec.dynamic.partition.mode</a></td><td colspan="1" class="confluenceTd">nonstrict (default is strict)</td></tr></tbody></table></div><h3 class="p6" id="HiveTransactions-ConfigurationValuestoSetforCompaction">Configuration Values to Set for Compaction</h3><p>If the data in your system is not owned by the Hive user (i.e., the user that the Hive metastore runs as), then Hive will need permission to run as the user who owns the data in order to perform compactions.  If you have already set up HiveServer2 to impersonate users, then the only additional work to do is assure that Hive has the right to impersonate users from the host running the Hive metastore.  This is done by adding the hostname to <code>hadoop.proxyuser.hive.hosts</code> in Hadoop's <code>core-site.xml</code> file.  If you have not already done this, then you will need to configure Hive to act as a proxy user.  This requires you to set up keytabs for the user running the Hive metastore and add <code>hadoop.proxyuser.hive.hosts</code> and <code>hadoop.proxyuser.hive.groups</code> to Hadoop's <code>core-site.xml</code> file.  See the Hadoop documentation on secure mode for your version of Hadoop (e.g., for Hadoop 2.5.1 it is at <a href="http://hadoop.apache.org/docs/r2.5.1/hadoop-project-dist/hadoop-common/SecureMode.html" class="external-link" rel="nofollow">Hadoop in Secure Mode</a>).</p><h2 class="p6" id="HiveTransactions-TableProperties">Table Properties</h2><p>If a table is to be used in ACID writes (insert, update, delete) then the table property &quot;<code>transactional=true</code>&quot; must be set on that table, starting with <a href="https://issues.apache.org/jira/browse/HIVE-8290" class="external-link" rel="nofollow">Hive 0.14.0</a>. Note, once a table has been defined as an ACID table via TBLPROPERTIES (&quot;transactional&quot;=&quot;true&quot;), it cannot be converted back to a non-ACID table, i.e., changing TBLPROPERTIES (&quot;transactional&quot;=&quot;false&quot;) is not allowed. Also, <a href="Configuration%2bProperties.html#ConfigurationProperties-hive.txn.manager">hive.txn.manager</a> must be set to <span>org.apache.hadoop.hive.ql.lockmgr.DbTxnManager either in hive-site.xml or in the beginning of the session before any query is run.</span> Without those, inserts will be done in the old style; updates and deletes will be prohibited prior to <span>HIVE-11716.  Since <span>HIVE-11716 operations on ACID tables without DbTxnManager are not allowed</span></span>.  However, this does not apply to Hive 0.13.0.</p><p class="p6">If a table owner does not wish the system to automatically determine when to compact, then the table property &quot;<code>NO_AUTO_COMPACTION</code>&quot; can be set.  This will prevent all automatic compactions.  Manual compactions can still be done with <a href="LanguageManual%2bDDL.html#LanguageManualDDL-AlterTable/PartitionCompact">Alter Table/Partition Compact</a> statements.</p><p class="p6">Table properties are set with the TBLPROPERTIES clause when a table is created or altered, as described in the <a href="LanguageManual%2bDDL.html#LanguageManualDDL-CreateTable">Create Table</a> and <a href="LanguageManual%2bDDL.html#LanguageManualDDL-AlterTableProperties">Alter Table Properties</a> sections of Hive Data Definition Language. The &quot;<code>transactional</code>&quot; and &quot;<code>NO_AUTO_COMPACTION</code>&quot; table properties are case-sensitive in Hive releases 0.x and 1.0, but they are case-insensitive starting with release 1.1.0 (<a href="https://issues.apache.org/jira/browse/HIVE-8308" class="external-link" rel="nofollow">HIVE-8308</a>).</p><p>More compaction related options can be set via TBLPROPERTIES as of <a href="https://issues.apache.org/jira/browse/HIVE-13354" class="external-link" rel="nofollow">Hive 1.3.0 and 2.1.0</a>. They can be set at both table-level via <a href="LanguageManual%2bDDL.html#LanguageManualDDL-Create/Drop/TruncateTable" rel="nofollow">CREATE TABLE</a>, and on request-level via <a href="LanguageManual%2bDDL.html#LanguageManualDDL-AlterTable/PartitionCompact" rel="nofollow">ALTER TABLE/PARTITION COMPACT</a>.  These are used to override the Warehouse/table wide settings.  For example, to override an MR property to affect a compaction job, one can add &quot;compactor.&lt;mr property name&gt;=&lt;value&gt;&quot; in either CREATE TABLE statement or when launching a compaction explicitly via ALTER TABLE.  The &quot;&lt;mr property name&gt;=&lt;value&gt;&quot; will be set on JobConf of the compaction MR job.   Similarly, &quot;tblprops.&lt;prop name&gt;=&lt;value&gt;&quot; can be used to set/override any table property which is interpreted by the code running on the cluster.  Finally, &quot;compactorthreshold.&lt;prop name&gt;=&lt;value&gt;&quot; can be used to override properties from the &quot;New Configuration Parameters for Transactions&quot; table above that end with &quot;.threshold&quot; and control when compactions are triggered by the system.  Examples:</p><div class="code panel pdl conf-macro output-block" style="border-width: 1px;" data-hasbody="true" data-macro-name="code"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Example: Set compaction options in TBLPROPERTIES at table level</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Default" data-theme="Default">CREATE TABLE table_name (
  id                int,
  name              string
)
CLUSTERED BY (id) INTO 2 BUCKETS STORED AS ORC
TBLPROPERTIES (&quot;transactional&quot;=&quot;true&quot;,
  &quot;compactor.mapreduce.map.memory.mb&quot;=&quot;2048&quot;,     -- specify compaction map job properties
  &quot;compactorthreshold.hive.compactor.delta.num.threshold&quot;=&quot;4&quot;,  -- trigger minor compaction if there are more than 4 delta directories
  &quot;compactorthreshold.hive.compactor.delta.pct.threshold&quot;=&quot;0.5&quot; -- trigger major compaction if the ratio of size of delta files to
                                                                   -- size of base files is greater than 50%
);</pre>
</div></div><div class="code panel pdl conf-macro output-block" style="border-width: 1px;" data-hasbody="true" data-macro-name="code"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>Example: Set compaction options in TBLPROPERTIES at request level</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Default" data-theme="Default">ALTER TABLE table_name COMPACT 'minor' 
   WITH OVERWRITE TBLPROPERTIES (&quot;compactor.mapreduce.map.memory.mb&quot;=&quot;3072&quot;);  -- specify compaction map job properties
ALTER TABLE table_name COMPACT 'major'
   WITH OVERWRITE TBLPROPERTIES (&quot;tblprops.orc.compress.size&quot;=&quot;8192&quot;);         -- change any other Hive table properties</pre>
</div></div><h1 id="HiveTransactions-TalksandPresentations">Talks and Presentations</h1><p>Transactional Operations In Hive by Eugene Koifman at <a href="https://dataworkssummit.com/san-jose-2017/agenda/" class="external-link" rel="nofollow">Dataworks Summit 2017, San Jose, CA, USA</a></p><ul><li><a href="https://www.slideshare.net/Hadoop_Summit/transactional-sql-in-apache-hive" class="external-link" rel="nofollow">Slides</a></li><li><a href="https://www.youtube.com/watch?v=Rk8irGDjpuI&amp;feature=youtu.be" class="external-link" rel="nofollow">Video</a></li></ul><p>DataWorks Summit 2018, San Jose, CA, USA - Covers Hive 3 and ACID V2 features</p><ul><li><a href="https://www.slideshare.net/Hadoop_Summit/transactional-operations-in-apache-hive-present-and-future-102803358" class="external-link" rel="nofollow">Slides</a></li><li><a href="https://www.youtube.com/watch?v=GyzU9wG0cFQ&amp;t=834s" class="external-link" rel="nofollow">Video</a></li></ul><p><br/></p><p><span style="text-indent: 20.0px;width: auto;text-align: center;color: rgb(255,255,255);display: none;">Save</span></p><p><span style="text-indent: 20.0px;width: auto;text-align: center;color: rgb(255,255,255);display: none;">Save</span></p>

                
        
    
        </div>

                        
    



<div id="labels-section" class="pageSection group">
    <div class="labels-section-content content-column" entityid="40509723" entitytype="page">
	<div class="labels-content">
		
    <ul class="label-list label-list-right ">
            <li class="no-labels-message">
            No labels
        </li>
            </ul>

    </div>
</div>
</div>
        
		
            




            
        








                        
    
<div id="comments-section" class="pageSection group">
        
    



</div>
        


                
    
            
</div>

    

    




    
    

    
    
    


    
<div id="space-tools-web-items" class="hidden">
                <div data-label="Overview" data-href="/confluence/spaces/viewspacesummary.action?key=Hive">Overview</div>
            <div data-label="Content Tools" data-href="/confluence/pages/reorderpages.action?key=Hive">Content Tools</div>
            <div data-label="Apps" data-href="/confluence/spaces/snippeterrors.action?key=Hive">Apps</div>
    </div>
        



            </div><!-- \#main -->
            
    
    
        
            
            

<div id="footer" role="contentinfo">
    <section class="footer-body">

                                                            <p class="license license-opensource">
                    Powered by a free <b>Atlassian Confluence Open Source Project License</b> granted to Apache Software Foundation. <a href="https://www.atlassian.com/software/views/opensource-community-additional-license-offer">Evaluate Confluence today</a>.<br>
                </p>
                    
        

        <ul id="poweredby">
            <li class="noprint">Powered by <a href="http://www.atlassian.com/software/confluence" class="hover-footer-link" rel="nofollow">Atlassian Confluence</a> <span id='footer-build-information'>7.13.2</span></li>
            <li class="print-only">Printed by Atlassian Confluence 7.13.2</li>
            <li class="noprint"><a href="https://support.atlassian.com/help/confluence" class="hover-footer-link" rel="nofollow">Report a bug</a></li>
            <li class="noprint"><a href="https://www.atlassian.com/company" class="hover-footer-link" rel="nofollow">Atlassian News</a></li>
        </ul>

        

        <div id="footer-logo"><a href="http://www.atlassian.com/" rel="nofollow">Atlassian</a></div>

                    
        
    </section>
</div>

    
</div>

</div><!-- \#full-height-container -->
</div><!-- \#page -->

    <span style="display:none;" id="confluence-server-performance">{"serverDuration": 63, "requestCorrelationId": "4dee3985ed0af800"}</span>
</body>

<!-- Mirrored from cwiki.apache.org/confluence/display/Hive/Hive+Transactions by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 15 Dec 2021 19:40:52 GMT -->
</html>
    
